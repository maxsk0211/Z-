<!DOCTYPE html>
<html lang="th" class="light-style layout-navbar-fixed layout-menu-fixed">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title>รายงานโครงการ | ระบบจัดสวนครบวงจร</title>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Core CSS -->
  <link rel="stylesheet" href="../assets/vendor/css/rtl/core.css" class="template-customizer-core-css">
  <link rel="stylesheet" href="../assets/vendor/css/rtl/theme-default.css" class="template-customizer-theme-css">
  <link rel="stylesheet" href="../assets/css/demo.css">

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css">
  <link rel="stylesheet" href="../assets/vendor/libs/typeahead-js/typeahead.css">
  <link rel="stylesheet" href="../assets/vendor/libs/flatpickr/flatpickr.css">
  <link rel="stylesheet" href="../assets/vendor/libs/select2/select2.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.41.0/apexcharts.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
  
  <!-- Page CSS -->
  <style>
    :root {
      --primary: #28a745;
      --primary-light: #e9fff0;
      --warning: #ffa726;
      --warning-light: #ffedcc;
      --danger: #ec407a;
      --danger-light: #ffe8e8;
      --info: #42a5f5;
      --info-light: #e3f2fd;
      --text-primary: #566a7f;
      --text-secondary: #99a0ac;
      --bg-light: #f5f6fa;
    }
    
    /* แก้ไขการแสดงผลเมนู */
    .menu-sub {
      display: none; /* ค่าเริ่มต้นซ่อนเมนูย่อย */
    }
    
    .menu-item.active.open > .menu-sub,
    .menu-sub.show {
      display: block !important; /* แสดงเมนูย่อยเมื่อ active หรือมี class show */
    }
    
    .section-heading {
      position: relative;
      padding-left: 1rem;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    
    .section-heading::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background-color: var(--primary);
      border-radius: 4px;
    }
    
    /* สไตล์สำหรับหน้ารายงาน */
    .card {
      transition: all 0.3s ease;
      border-radius: 0.75rem;
      border: none;
      box-shadow: 0 0.25rem 1rem rgba(161, 172, 184, 0.12);
      margin-bottom: 1.5rem;
    }
    
    .project-header {
      padding: 1.5rem;
      border-radius: 0.75rem 0.75rem 0 0;
      background-color: var(--primary);
      color: white;
    }
    
    .project-info {
      padding: 1.5rem;
      background-color: var(--primary-light);
      border-radius: 0 0 0.75rem 0.75rem;
    }
    
    .project-info-item {
      margin-bottom: 0.5rem;
    }
    
    .project-info-label {
      font-weight: 500;
      min-width: 120px;
      display: inline-block;
    }
    
    .project-progress {
      height: 8px;
      border-radius: 4px;
      margin-top: 0.5rem;
    }
    
    .filter-card {
      margin-bottom: 1rem;
      border-radius: 0.75rem;
      padding: 1rem;
    }
    
    .summary-card {
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      height: 100%;
    }
    
    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0.5rem 1.5rem rgba(161, 172, 184, 0.2);
    }
    
    .summary-icon {
      width: 48px;
      height: 48px;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }
    
    .bg-label-primary {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .bg-label-warning {
      background-color: var(--warning-light);
      color: var(--warning);
    }
    
    .bg-label-danger {
      background-color: var(--danger-light);
      color: var(--danger);
    }
    
    .bg-label-info {
      background-color: var(--info-light);
      color: var(--info);
    }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    .table th {
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
      background-color: #f9f9fa;
      vertical-align: middle;
    }
    
    .table td {
      vertical-align: middle;
    }
    
    .lot-header {
      background-color: var(--bg-light);
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      border-radius: 0.5rem;
      border-left: 4px solid var(--primary);
    }
    
    .lot-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .lot-info {
      display: flex;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    .lot-info-item {
      margin-right: 1.5rem;
    }
    
    .status-badge {
      padding: 0.35em 0.65em;
      font-size: 0.75em;
      font-weight: 500;
      line-height: 1;
      color: #fff;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25rem;
    }
    
    .status-completed {
      background-color: var(--primary);
    }
    
    .status-in-progress {
      background-color: var(--warning);
    }
    
    .status-overdue {
      background-color: var(--danger);
    }
    
    .status-pending {
      background-color: var(--info);
    }
    
    .condition-badge {
      padding: 0.35em 0.65em;
      font-size: 0.75em;
      font-weight: 500;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25rem;
    }
    
    .condition-good {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .condition-damaged {
      background-color: var(--warning-light);
      color: var(--warning);
    }
    
    .condition-broken {
      background-color: var(--danger-light);
      color: var(--danger);
    }
    
    .chart-container {
      height: 240px;
      position: relative;
    }
    
    .search-box {
      position: relative;
    }
    
    .search-box .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }
    
    .search-box .form-control {
      padding-left: 2.5rem;
    }
    
    .pagination-info {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    .report-company-logo {
      max-height: 60px;
      margin-bottom: 1rem;
    }
    
    .report-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .form-control, .form-select {
      border-radius: 0.375rem;
      padding: 0.45rem 0.9rem;
      border: 1px solid #dce1e8;
      font-size: 0.9375rem;
      transition: all 0.2s ease;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
    }
    
    .material-status-progress {
      height: 6px;
      border-radius: 3px;
      overflow: hidden;
    }
    
    .material-status-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }
    
    .accordion-item {
      border-radius: 0.5rem;
      overflow: hidden;
      margin-bottom: 1rem;
      border: 1px solid rgba(0,0,0,.125);
    }
    
    .accordion-button {
      border-radius: 0 !important;
    }
    
    .timeline {
      position: relative;
      padding-left: 1.5rem;
      margin-top: 1rem;
    }
    
    .timeline-item {
      position: relative;
      padding-bottom: 1rem;
    }
    
    .timeline-item:before {
      content: '';
      position: absolute;
      left: -1.5rem;
      top: 0;
      width: 1px;
      height: 100%;
      background-color: #dce1e8;
    }
    
    .timeline-item:last-child:before {
      height: 50%;
    }
    
    .timeline-item:after {
      content: '';
      position: absolute;
      left: -1.75rem;
      top: 0.25rem;
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 50%;
      background-color: var(--primary);
    }
    
    .timeline-date {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }
    
    .timeline-title {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }
    
    .timeline-body {
      font-size: 0.875rem;
      color: var(--text-primary);
    }
    
    .dataTables_wrapper .dataTables_filter {
      margin-bottom: 1rem;
    }
    
    .dataTables_wrapper .dataTables_filter input {
      border-radius: 0.375rem;
      padding: 0.45rem 0.9rem;
      border: 1px solid #dce1e8;
    }
    
    .dataTables_wrapper .dataTables_length select {
      border-radius: 0.375rem;
      padding: 0.375rem 1.75rem 0.375rem 0.75rem;
      border: 1px solid #dce1e8;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: var(--primary);
      color: white !important;
      border: 1px solid var(--primary);
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover:not(.current) {
      background: var(--primary-light);
      color: var(--primary) !important;
      border: 1px solid var(--primary-light);
    }
    
    .nav-tabs .nav-link {
      font-weight: 500;
      color: var(--text-secondary);
      padding: 0.75rem 1.25rem;
      border: none;
      border-bottom: 2px solid transparent;
    }
    
    .nav-tabs .nav-link.active {
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
      background-color: transparent;
    }
    
    .nav-tabs .nav-link:hover:not(.active) {
      border-bottom: 2px solid #dce1e8;
      color: var(--text-primary);
    }
    
    .tab-content {
      padding-top: 1.5rem;
    }
    
    .form-switch {
      padding-left: 2.5em;
    }
    
    .form-switch .form-check-input {
      width: 2em;
    }
    
    .gantt-chart {
      width: 100%;
      min-height: 100px;
      background-color: white;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .gantt-project-bar {
      height: 24px;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      position: relative;
      background-color: var(--primary-light);
    }
    
    .gantt-progress-bar {
      height: 100%;
      border-radius: 4px;
      background-color: var(--primary);
    }
    
    .gantt-label {
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-primary);
      font-size: 0.75rem;
      font-weight: 500;
      white-space: nowrap;
    }
    
    .gantt-timeline {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
    }
    
    .gantt-timeline-item {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }
    
    .compare-checkbox-group {
      margin-bottom: 1rem;
    }
    
    .compare-checkbox-item {
      margin-bottom: 0.5rem;
    }
    
    .compare-result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      background-color: var(--bg-light);
    }
    
    .compare-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .compare-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }
    
    .compare-table th, .compare-table td {
      font-size: 0.875rem;
    }
    
    .compare-table th:first-child, .compare-table td:first-child {
      font-weight: 500;
    }
  </style>
</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      
      <!-- Menu -->
      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo">
          <a href="dashboard.html" class="app-brand-link">
            <span class="app-brand-logo demo">
              <svg width="26px" height="26px" viewBox="0 0 26 26" version="1.1">
                <polygon points="7.5 2 7.5 5 4.5 5 4.5 22 17 22 17 19 22 19 22 5 17 5 17 2" fill="#28a745" />
                <polygon points="13 15 10 12 13 9 16 12" fill="#28a745" opacity="0.7" />
              </svg>
            </span>
            <span class="app-brand-text demo menu-text fw-bold ms-2">Green Gardens</span>
          </a>

          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto sidebar-toggle">
            <i class="bx menu-toggle-icon d-none d-xl-block fs-4"></i>
            <i class="bx bx-x d-block d-xl-none bx-sm"></i>
          </a>
        </div>

        <div class="menu-divider mt-0"></div>

        <div class="menu-inner-shadow"></div>

        <ul class="menu-inner py-1">
          <!-- Dashboard -->
          <li class="menu-item">
            <a href="dashboard.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-home-circle"></i>
              <div data-i18n="หน้าหลัก">หน้าหลัก</div>
            </a>
          </li>

          <!-- โครงการลูกค้า -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">จัดการโครงการลูกค้า</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-layout"></i>
              <div data-i18n="โครงการ">โครงการ</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="project-list.html" class="menu-link">
                  <div data-i18n="รายการโครงการ">รายการโครงการ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="project-add.html" class="menu-link">
                  <div data-i18n="เพิ่มโครงการใหม่">เพิ่มโครงการใหม่</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="project-progress.html" class="menu-link">
                  <div data-i18n="ติดตามความคืบหน้า">ติดตามความคืบหน้า</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- วัสดุ -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">จัดการวัสดุและเครื่องมือ</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-package"></i>
              <div data-i18n="วัสดุทั่วไป">วัสดุทั่วไป</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="material-list.html" class="menu-link">
                  <div data-i18n="รายการวัสดุ">รายการวัสดุ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="material-add.html" class="menu-link">
                  <div data-i18n="เพิ่มวัสดุใหม่">เพิ่มวัสดุใหม่</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="stock-receipt.html" class="menu-link">
                  <div data-i18n="รับเข้าสต็อก">รับเข้าสต็อก</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-cube-alt"></i>
              <div data-i18n="วัสดุเครื่องมือช่าง">วัสดุเครื่องมือช่าง</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="construction-list.html" class="menu-link">
                  <div data-i18n="รายการวัสดุ">รายการวัสดุ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="construction-add.html" class="menu-link">
                  <div data-i18n="เพิ่มวัสดุใหม่">เพิ่มวัสดุใหม่</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-wrench"></i>
              <div data-i18n="เครื่องมือช่าง">เครื่องมือช่าง</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="tools-list.html" class="menu-link">
                  <div data-i18n="รายการเครื่องมือ">รายการเครื่องมือ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="tools-add.html" class="menu-link">
                  <div data-i18n="เพิ่มเครื่องมือใหม่">เพิ่มเครื่องมือใหม่</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item">
            <a href="inventory-withdraw.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-transfer"></i>
              <div data-i18n="เบิก-คืนวัสดุ">เบิก-คืนวัสดุ</div>
            </a>
          </li>

          <!-- รถ -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">จัดการยานพาหนะ</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-car"></i>
              <div data-i18n="ยานพาหนะ">ยานพาหนะ</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="vehicle-list.html" class="menu-link">
                  <div data-i18n="รายการรถ">รายการรถ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="vehicle-add.html" class="menu-link">
                  <div data-i18n="เพิ่มรถใหม่">เพิ่มรถใหม่</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="vehicle-repair.html" class="menu-link">
                  <div data-i18n="บันทึกการซ่อม">บันทึกการซ่อม</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- รายงาน -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">รายงาน</span>
          </li>

          <li class="menu-item active open">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-line-chart"></i>
              <div data-i18n="รายงานต่างๆ">รายงานต่างๆ</div>
            </a>
            <ul class="menu-sub" style="display: block;">
              <li class="menu-item active">
                <a href="report-projects.html" class="menu-link">
                  <div data-i18n="รายงานโครงการ">รายงานโครงการ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="report-vehicle-cost.html" class="menu-link">
                  <div data-i18n="รายงานค่าใช้จ่ายรถ">รายงานค่าใช้จ่ายรถ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="report-executive.html" class="menu-link">
                  <div data-i18n="รายงานสำหรับผู้บริหาร">รายงานสำหรับผู้บริหาร</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="report-stock-value.html" class="menu-link">
                  <div data-i18n="รายงานมูลค่าคงคลัง">รายงานมูลค่าคงคลัง</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- ผู้ใช้งาน -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">ระบบจัดการ</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-user"></i>
              <div data-i18n="ผู้ใช้งาน">ผู้ใช้งาน</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="user-list.html" class="menu-link">
                  <div data-i18n="รายชื่อผู้ใช้">รายชื่อผู้ใช้</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="user-add.html" class="menu-link">
                  <div data-i18n="เพิ่มผู้ใช้ใหม่">เพิ่มผู้ใช้ใหม่</div>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </aside>
      <!-- / Menu -->

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->
        <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
              <i class="bx bx-menu bx-sm"></i>
            </a>
          </div>

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <!-- Search -->
            <div class="navbar-nav align-items-center">
              <div class="nav-item navbar-search-wrapper mb-0">
                <a class="nav-item nav-link search-toggler px-0" href="javascript:void(0);">
                  <i class="bx bx-search-alt bx-sm"></i>
                  <span class="d-none d-md-inline-block text-muted">ค้นหา (Ctrl+/)</span>
                </a>
              </div>
            </div>
            <!-- /Search -->

            <ul class="navbar-nav flex-row align-items-center ms-auto">
              <!-- Notification -->
              <li class="nav-item dropdown-notifications navbar-dropdown dropdown me-3 me-xl-2">
                <a class="nav-link dropdown-toggle hide-arrow position-relative" href="javascript:void(0);" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                  <i class="bx bx-bell bx-sm"></i>
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">5</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end py-0 dropdown-menu-notification">
                  <li class="dropdown-menu-header border-bottom">
                    <div class="dropdown-header d-flex align-items-center py-3">
                      <h5 class="text-body mb-0 me-auto">การแจ้งเตือน</h5>
                      <a href="javascript:void(0)" class="dropdown-notifications-all text-body" data-bs-toggle="tooltip" data-bs-placement="top" title="Mark all as read"><i class="bx fs-4 bx-envelope-open"></i></a>
                    </div>
                  </li>
                  <li class="dropdown-notifications-list scrollable-container">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item list-group-item-action dropdown-notifications-item">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar bg-light-danger">
                              <span class="avatar-initial rounded-circle bg-label-danger"><i class="bx bx-package"></i></span>
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-1">วัสดุใกล้หมด</h6>
                            <p class="mb-0">ดินปลูกต้นไม้ เหลือน้อยกว่า 10 ถุง</p>
                            <small class="text-muted">1 ชั่วโมงที่แล้ว</small>
                          </div>
                          <div class="flex-shrink-0 dropdown-notifications-actions">
                            <a href="javascript:void(0)" class="dropdown-notifications-read"><span class="badge badge-dot"></span></a>
                            <a href="javascript:void(0)" class="dropdown-notifications-archive"><span class="bx bx-x"></span></a>
                          </div>
                        </div>
                      </li>
                      <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar">
                              <span class="avatar-initial rounded-circle bg-label-warning"><i class="bx bx-error"></i></span>
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-1">วัสดุหมด</h6>
                            <p class="mb-0">หินแกรนิตก้อนเล็ก หมดสต็อก</p>
                            <small class="text-muted">เมื่อวานนี้</small>
                          </div>
                          <div class="flex-shrink-0 dropdown-notifications-actions">
                            <a href="javascript:void(0)" class="dropdown-notifications-read"><span class="badge badge-dot"></span></a>
                            <a href="javascript:void(0)" class="dropdown-notifications-archive"><span class="bx bx-x"></span></a>
                          </div>
                        </div>
                      </li>
                    </ul>
                  </li>
                  <li class="dropdown-menu-footer border-top p-2">
                    <a href="javascript:void(0);" class="btn btn-primary d-flex justify-content-center">
                      ดูการแจ้งเตือนทั้งหมด
                    </a>
                  </li>
                </ul>
              </li>
              <!--/ Notification -->

              <!-- User -->
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../assets/img/avatars/1.png" alt class="rounded-circle">
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="account-settings.html">
                      <div class="d-flex">
                        <div class="flex-shrink-0 me-3">
                          <div class="avatar avatar-online">
                            <img src="../assets/img/avatars/1.png" alt class="rounded-circle">
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <span class="fw-semibold d-block">บุญชัย ผู้จัดการ</span>
                          <small class="text-muted">ผู้บริหาร</small>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="account-settings.html">
                      <i class="bx bx-user me-2"></i>
                      <span class="align-middle">ข้อมูลส่วนตัว</span>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="login.html">
                      <i class="bx bx-power-off me-2"></i>
                      <span class="align-middle">ออกจากระบบ</span>
                    </a>
                  </li>
                </ul>
              </li>
              <!--/ User -->
            </ul>
          </div>
        </nav>
        <!-- / Navbar -->

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->
          <div class="container-xxl flex-grow-1 container-p-y">
            <h4 class="fw-bold py-3 mb-4">
              <span class="text-muted fw-light">รายงาน /</span> รายงานโครงการ
            </h4>

            <!-- ค้นหาและตัวกรอง -->
            <div class="card filter-card mb-4">
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-3">
                    <label for="projectSearch" class="form-label">ค้นหาโครงการ</label>
                    <div class="search-box">
                      <i class="bx bx-search search-icon"></i>
                      <input type="text" class="form-control" id="projectSearch" placeholder="ค้นหาตามรหัส, ชื่อโครงการ, ลูกค้า...">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label for="projectStatus" class="form-label">สถานะโครงการ</label>
                    <select class="form-select" id="projectStatus">
                      <option value="">ทุกสถานะ</option>
                      <option value="completed">เสร็จสิ้น</option>
                      <option value="in-progress" selected>กำลังดำเนินการ</option>
                      <option value="pending">รอดำเนินการ</option>
                      <option value="overdue">เกินกำหนด</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="projectStartDate" class="form-label">วันที่เริ่มต้น</label>
                    <input type="text" class="form-control flatpickr-date" id="projectStartDate" placeholder="เลือกวันที่เริ่มต้น">
                  </div>
                  <div class="col-md-3">
                    <label for="projectEndDate" class="form-label">วันที่สิ้นสุด</label>
                    <input type="text" class="form-control flatpickr-date" id="projectEndDate" placeholder="เลือกวันที่สิ้นสุด">
                  </div>
                  <div class="col-12 d-flex justify-content-end">
                    <button type="button" class="btn btn-outline-secondary me-2" id="resetFilterBtn">
                      <i class="bx bx-reset me-1"></i> รีเซ็ต
                    </button>
                    <button type="button" class="btn btn-primary" id="searchBtn">
                      <i class="bx bx-search me-1"></i> ค้นหา
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- สรุปข้อมูลโครงการ -->
            <div class="row">
              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-primary rounded">
                          <i class="bx bx-layout"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu1" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu1">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">25 โครงการ</h4>
                      <p class="mb-0">โครงการทั้งหมด</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-success rounded">
                          <i class="bx bx-check-circle"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu2" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu2">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">12 โครงการ</h4>
                      <p class="mb-0">เสร็จสิ้น</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-warning rounded">
                          <i class="bx bx-time"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu3" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu3">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">9 โครงการ</h4>
                      <p class="mb-0">กำลังดำเนินการ</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-danger rounded">
                          <i class="bx bx-error-circle"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu4" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu4">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">4 โครงการ</h4>
                      <p class="mb-0">เกินกำหนด</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- สรุปรายงานโครงการและการเบิก-คืนวัสดุ -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <h5 class="card-title mb-0">สรุปรายงานโครงการและการเบิก-คืนวัสดุ</h5>
                  <div class="report-actions">
                    <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#compareProjectsModal">
                      <i class="bx bx-git-compare me-1"></i> เปรียบเทียบโครงการ
                    </button>
                    <div class="dropdown">
                      <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bx bx-export me-1"></i> ส่งออก
                      </button>
                      <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                        <li><a class="dropdown-item" href="javascript:void(0);" id="exportPDF"><i class="bx bxs-file-pdf me-1"></i> PDF</a></li>
                        <li><a class="dropdown-item" href="javascript:void(0);" id="exportExcel"><i class="bx bxs-file-export me-1"></i> Excel</a></li>
                        <li><a class="dropdown-item" href="javascript:void(0);" id="exportCSV"><i class="bx bx-spreadsheet me-1"></i> CSV</a></li>
                      </ul>
                    </div>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="printReport">
                      <i class="bx bx-printer me-1"></i> พิมพ์
                    </button>
                  </div>
                </div>

                <!-- ตารางรายการโครงการ -->
                <div class="table-responsive">
                  <table class="table table-hover" id="projectsTable">
                    <thead>
                      <tr>
                        <th>รหัสโครงการ</th>
                        <th>ชื่อโครงการ</th>
                        <th>ลูกค้า</th>
                        <th>วันที่เริ่ม</th>
                        <th>กำหนดเสร็จ</th>
                        <th>สถานะ</th>
                        <th>มูลค่าวัสดุ (บาท)</th>
                        <th>จัดการ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>P-2568-001</td>
                        <td>
                          <a href="javascript:void(0);" class="text-primary fw-semibold" data-bs-toggle="collapse" data-bs-target="#collapseProject1" aria-expanded="false" aria-controls="collapseProject1">
                            จัดสวนบ้านคุณเบียร์ Parkinson
                          </a>
                        </td>
                        <td>คุณอริยคุณ (คุณเบียร์)</td>
                        <td>15/03/2568</td>
                        <td>15/04/2568</td>
                        <td><span class="status-badge status-in-progress">กำลังดำเนินการ</span></td>
                        <td>9,450.28</td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด" onclick="viewProjectDetail('P-2568-001')">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์รายงาน" onclick="printProjectReport('P-2568-001')">
                              <i class="bx bx-printer"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="ส่งออกข้อมูล" onclick="exportProjectData('P-2568-001')">
                              <i class="bx bx-export"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      <tr class="collapse" id="collapseProject1">
                        <td colspan="8" class="p-0">
                          <div class="p-3 bg-light">
                            <div class="mb-3">
                              <h6 class="mb-2">ข้อมูลเพิ่มเติม</h6>
                              <div class="row">
                                <div class="col-md-4">
                                  <p class="mb-1"><strong>รูปแบบงาน:</strong> งานตามสัญญา</p>
                                  <p class="mb-1"><strong>ผู้รับผิดชอบ:</strong> สมศักดิ์ ช่างจัดสวน</p>
                                  <p class="mb-1"><strong>ความคืบหน้า:</strong> 65%</p>
                                </div>
                                <div class="col-md-4">
                                  <p class="mb-1"><strong>ราคาโครงการ:</strong> ฿80,000.00</p>
                                  <p class="mb-1"><strong>มูลค่าวัสดุที่เบิก:</strong> ฿4,402.59</p>
                                  <p class="mb-1"><strong>มูลค่าวัสดุที่คืน:</strong> ฿1,766.27</p>
                                </div>
                                <div class="col-md-4">
                                  <p class="mb-1"><strong>มูลค่าวัสดุสุทธิ:</strong> ฿2,636.32</p>
                                  <p class="mb-1"><strong>จำนวนรายการวัสดุ:</strong> 35 รายการ</p>
                                  <p class="mb-1"><strong>สัดส่วนต้นทุนวัสดุ:</strong> 3.29% ของราคาโครงการ</p>
                                </div>
                              </div>
                            </div>
                            
                            <!-- Timeline และ แกนต์ชาร์ต -->
                            <div class="row mb-3">
                              <div class="col-md-6">
                                <h6 class="mb-2">ไทม์ไลน์โครงการ</h6>
                                <div class="timeline">
                                  <div class="timeline-item">
                                    <div class="timeline-date">15/03/2568</div>
                                    <div class="timeline-title">เริ่มโครงการ</div>
                                    <div class="timeline-body">ประชุมกับลูกค้าและเตรียมพื้นที่</div>
                                  </div>
                                  <div class="timeline-item">
                                    <div class="timeline-date">20/03/2568</div>
                                    <div class="timeline-title">เริ่มงานขุดและปรับพื้นที่</div>
                                    <div class="timeline-body">เบิกวัสดุงวดที่ 1 จำนวน 20 รายการ</div>
                                  </div>
                                  <div class="timeline-item">
                                    <div class="timeline-date">28/03/2568</div>
                                    <div class="timeline-title">ตรวจสอบความคืบหน้า</div>
                                    <div class="timeline-body">ความคืบหน้า 45% และคืนวัสดุบางส่วน</div>
                                  </div>
                                  <div class="timeline-item">
                                    <div class="timeline-date">02/04/2568</div>
                                    <div class="timeline-title">เบิกวัสดุงวดที่ 2</div>
                                    <div class="timeline-body">เบิกวัสดุเพิ่มเติม 15 รายการ</div>
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <h6 class="mb-2">แกนต์ชาร์ต</h6>
                                <div class="gantt-chart">
                                  <div class="gantt-project-bar">
                                    <div class="gantt-progress-bar" style="width: 100%;"></div>
                                    <span class="gantt-label">ขุดและปรับพื้นที่ (100%)</span>
                                  </div>
                                  <div class="gantt-project-bar">
                                    <div class="gantt-progress-bar" style="width: 80%;"></div>
                                    <span class="gantt-label">งานโครงสร้าง (80%)</span>
                                  </div>
                                  <div class="gantt-project-bar">
                                    <div class="gantt-progress-bar" style="width: 60%;"></div>
                                    <span class="gantt-label">ระบบน้ำ (60%)</span>
                                  </div>
                                  <div class="gantt-project-bar">
                                    <div class="gantt-progress-bar" style="width: 30%;"></div>
                                    <span class="gantt-label">ลงดินและปลูกต้นไม้ (30%)</span>
                                  </div>
                                  <div class="gantt-project-bar">
                                    <div class="gantt-progress-bar" style="width: 0%;"></div>
                                    <span class="gantt-label">ตกแต่งและทำความสะอาด (0%)</span>
                                  </div>
                                  <div class="gantt-timeline">
                                    <div class="gantt-timeline-item">15/03</div>
                                    <div class="gantt-timeline-item">22/03</div>
                                    <div class="gantt-timeline-item">29/03</div>
                                    <div class="gantt-timeline-item">05/04</div>
                                    <div class="gantt-timeline-item">12/04</div>
                                    <div class="gantt-timeline-item">15/04</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            
                            <!-- แท็บสำหรับเลือกดูข้อมูลต่างๆ -->
                            <ul class="nav nav-tabs" id="projectDetailTabs" role="tablist">
                              <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="inventoryTab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab" aria-controls="inventory" aria-selected="true">
                                  รายการวัสดุ
                                </button>
                              </li>
                              <li class="nav-item" role="presentation">
                                <button class="nav-link" id="lotTab" data-bs-toggle="tab" data-bs-target="#lot" type="button" role="tab" aria-controls="lot" aria-selected="false">
                                  แยกตามล็อตสินค้า
                                </button>
                              </li>
                              <li class="nav-item" role="presentation">
                                <button class="nav-link" id="summaryTab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab" aria-controls="summary" aria-selected="false">
                                  สรุปต้นทุนวัสดุ
                                </button>
                              </li>
                            </ul>
                            
                            <div class="tab-content" id="projectDetailTabContent">
                              <!-- แท็บรายการวัสดุ -->
                              <div class="tab-pane fade show active" id="inventory" role="tabpanel" aria-labelledby="inventoryTab">
                                <div class="table-responsive">
                                  <table class="table table-sm table-hover">
                                    <thead>
                                      <tr>
                                        <th>ลำดับ</th>
                                        <th>รายการ</th>
                                        <th>จำนวนเบิกจริง</th>
                                        <th>จำนวนคืนจริง</th>
                                        <th>รวมใช้จริง</th>
                                        <th>ราคาต่อหน่วย</th>
                                        <th>รวมจำนวนเงินสุทธิ</th>
                                        <th>หมายเหตุ</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr>
                                        <td>1</td>
                                        <td>สีโปว๊ ขนาด 0.5 กก.</td>
                                        <td>1 ถัง</td>
                                        <td>-</td>
                                        <td>1 ถัง</td>
                                        <td>38.75</td>
                                        <td>38.75</td>
                                        <td>-</td>
                                      </tr>
                                      <tr>
                                        <td>2</td>
                                        <td>ทินเนอร์ขวดแก้ว</td>
                                        <td>2 ขวด</td>
                                        <td>-</td>
                                        <td>2 ขวด</td>
                                        <td>29.00</td>
                                        <td>58.00</td>
                                        <td>-</td>
                                      </tr>
                                      <tr>
                                        <td>3</td>
                                        <td>ใบตัดปูน 4 นิ้ว</td>
                                        <td>3 ใบ</td>
                                        <td>-</td>
                                        <td>3 ใบ</td>
                                        <td>88.00</td>
                                        <td>264.00</td>
                                        <td>-</td>
                                      </tr>
                                      <tr>
                                        <td>4</td>
                                        <td>ใบตัดเหล็ก 4 นิ้ว</td>
                                        <td>3 ใบ</td>
                                        <td>1 ใบ</td>
                                        <td>2 ใบ</td>
                                        <td>10.17</td>
                                        <td>20.34</td>
                                        <td>-</td>
                                      </tr>
                                      <tr>
                                        <td>5</td>
                                        <td>แปรงทาสีรองพื้น และสีจริง 2 นิ้ว</td>
                                        <td>2 อัน</td>
                                        <td>1 อัน</td>
                                        <td>1 อัน</td>
                                        <td>18.55</td>
                                        <td>18.55</td>
                                        <td>-</td>
                                      </tr>
                                      <tr>
                                        <td colspan="5" class="text-end fw-bold">รวมทั้งสิ้น</td>
                                        <td colspan="3" class="fw-bold">2,636.32 บาท</td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                  <div class="pagination-info">
                                    แสดง 1 ถึง 5 จาก 35 รายการ
                                  </div>
                                  <nav aria-label="Page navigation">
                                    <ul class="pagination pagination-sm">
                                      <li class="page-item prev">
                                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-left"></i></a>
                                      </li>
                                      <li class="page-item active">
                                        <a class="page-link" href="javascript:void(0);">1</a>
                                      </li>
                                      <li class="page-item">
                                        <a class="page-link" href="javascript:void(0);">2</a>
                                      </li>
                                      <li class="page-item">
                                        <a class="page-link" href="javascript:void(0);">3</a>
                                      </li>
                                      <li class="page-item next">
                                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-right"></i></a>
                                      </li>
                                    </ul>
                                  </nav>
                                </div>
                              </div>
                              
                              <!-- แท็บแยกตามล็อตสินค้า -->
                              <div class="tab-pane fade" id="lot" role="tabpanel" aria-labelledby="lotTab">
                                <div class="accordion" id="lotAccordion">
                                  <!-- ล็อตที่ 1 -->
                                  <div class="accordion-item">
                                    <h2 class="accordion-header" id="lotHeading1">
                                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#lotCollapse1" aria-expanded="true" aria-controls="lotCollapse1">
                                        <div>
                                          <span class="fw-bold">ล็อต: LOT-20240301-A</span>
                                          <div class="text-muted small">วันที่รับเข้า: 01/03/2568 | ผู้จำหน่าย: บริษัท ABC วัสดุก่อสร้าง</div>
                                        </div>
                                      </button>
                                    </h2>
                                    <div id="lotCollapse1" class="accordion-collapse collapse show" aria-labelledby="lotHeading1" data-bs-parent="#lotAccordion">
                                      <div class="accordion-body p-0">
                                        <div class="table-responsive">
                                          <table class="table table-sm table-hover mb-0">
                                            <thead>
                                              <tr>
                                                <th>ลำดับ</th>
                                                <th>รหัสสินค้า</th>
                                                <th>รายการ</th>
                                                <th>ราคา/หน่วย</th>
                                                <th>เบิกจริง</th>
                                                <th>คืนจริง</th>
                                                <th>ใช้จริง</th>
                                                <th>รวมเงินสุทธิ</th>
                                                <th>หมายเหตุ</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <tr>
                                                <td>1</td>
                                                <td>PT-001</td>
                                                <td>สีโปว๊ ขนาด 0.5 กก.</td>
                                                <td>38.75</td>
                                                <td>1 ถัง</td>
                                                <td>-</td>
                                                <td>1 ถัง</td>
                                                <td>38.75</td>
                                                <td>-</td>
                                              </tr>
                                              <tr>
                                                <td>2</td>
                                                <td>TN-001</td>
                                                <td>ทินเนอร์ขวดแก้ว</td>
                                                <td>29.00</td>
                                                <td>2 ขวด</td>
                                                <td>-</td>
                                                <td>2 ขวด</td>
                                                <td>58.00</td>
                                                <td>-</td>
                                              </tr>
                                              <tr>
                                                <td>3</td>
                                                <td>CT-001</td>
                                                <td>ใบตัดปูน 4 นิ้ว</td>
                                                <td>88.00</td>
                                                <td>3 ใบ</td>
                                                <td>-</td>
                                                <td>3 ใบ</td>
                                                <td>264.00</td>
                                                <td>-</td>
                                              </tr>
                                              <tr>
                                                <td colspan="7" class="text-end fw-bold">รวมมูลค่าล็อต</td>
                                                <td class="fw-bold">360.75</td>
                                                <td></td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  
                                  <!-- ล็อตที่ 2 -->
                                  <div class="accordion-item">
                                    <h2 class="accordion-header" id="lotHeading2">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#lotCollapse2" aria-expanded="false" aria-controls="lotCollapse2">
                                        <div>
                                          <span class="fw-bold">ล็อต: LOT-20240225-B</span>
                                          <div class="text-muted small">วันที่รับเข้า: 25/02/2568 | ผู้จำหน่าย: บริษัท XYZ การก่อสร้าง</div>
                                        </div>
                                      </button>
                                    </h2>
                                    <div id="lotCollapse2" class="accordion-collapse collapse" aria-labelledby="lotHeading2" data-bs-parent="#lotAccordion">
                                      <div class="accordion-body p-0">
                                        <div class="table-responsive">
                                          <table class="table table-sm table-hover mb-0">
                                            <thead>
                                              <tr>
                                                <th>ลำดับ</th>
                                                <th>รหัสสินค้า</th>
                                                <th>รายการ</th>
                                                <th>ราคา/หน่วย</th>
                                                <th>เบิกจริง</th>
                                                <th>คืนจริง</th>
                                                <th>ใช้จริง</th>
                                                <th>รวมเงินสุทธิ</th>
                                                <th>หมายเหตุ</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <tr>
                                                <td>1</td>
                                                <td>CT-002</td>
                                                <td>ใบตัดเหล็ก 4 นิ้ว</td>
                                                <td>10.17</td>
                                                <td>3 ใบ</td>
                                                <td>1 ใบ</td>
                                                <td>2 ใบ</td>
                                                <td>20.34</td>
                                                <td>คืนเนื่องจากไม่ได้ใช้</td>
                                              </tr>
                                              <tr>
                                                <td>2</td>
                                                <td>BR-001</td>
                                                <td>แปรงทาสีรองพื้น และสีจริง 2 นิ้ว</td>
                                                <td>18.55</td>
                                                <td>2 อัน</td>
                                                <td>1 อัน</td>
                                                <td>1 อัน</td>
                                                <td>18.55</td>
                                                <td>-</td>
                                              </tr>
                                              <tr>
                                                <td>3</td>
                                                <td>BR-002</td>
                                                <td>แปรงทาสีรองพื้น และสีจริง 2.1/2 นิ้ว</td>
                                                <td>26.08</td>
                                                <td>2 อัน</td>
                                                <td>1 อัน</td>
                                                <td>1 อัน</td>
                                                <td>26.08</td>
                                                <td>-</td>
                                              </tr>
                                              <tr>
                                                <td colspan="7" class="text-end fw-bold">รวมมูลค่าล็อต</td>
                                                <td class="fw-bold">64.97</td>
                                                <td></td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  
                                  <!-- ล็อตที่ 3 -->
                                  <div class="accordion-item">
                                    <h2 class="accordion-header" id="lotHeading3">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#lotCollapse3" aria-expanded="false" aria-controls="lotCollapse3">
                                        <div>
                                          <span class="fw-bold">ล็อต: LOT-20240310-C</span>
                                          <div class="text-muted small">วันที่รับเข้า: 10/03/2568 | ผู้จำหน่าย: ร้านวัสดุก่อสร้างสมบูรณ์</div>
                                        </div>
                                      </button>
                                    </h2>
                                    <div id="lotCollapse3" class="accordion-collapse collapse" aria-labelledby="lotHeading3" data-bs-parent="#lotAccordion">
                                      <div class="accordion-body p-0">
                                        <div class="table-responsive">
                                          <table class="table table-sm table-hover mb-0">
                                            <thead>
                                              <tr>
                                                <th>ลำดับ</th>
                                                <th>รหัสสินค้า</th>
                                                <th>รายการ</th>
                                                <th>ราคา/หน่วย</th>
                                                <th>เบิกจริง</th>
                                                <th>คืนจริง</th>
                                                <th>ใช้จริง</th>
                                                <th>รวมเงินสุทธิ</th>
                                                <th>หมายเหตุ</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <tr>
                                                <td>1</td>
                                                <td>PT-002</td>
                                                <td>สีรองพื้นปูนเก่า B-1900</td>
                                                <td>555.00</td>
                                                <td>1 แกลลอน</td>
                                                <td>-</td>
                                                <td>1 แกลลอน</td>
                                                <td>555.00</td>
                                                <td>-</td>
                                              </tr>
                                              <tr>
                                                <td>2</td>
                                                <td>GL-001</td>
                                                <td>น้ำยาประสานทราย</td>
                                                <td>1,150.00</td>
                                                <td>1 แกลลอน</td>
                                                <td>0.5 แกลลอน</td>
                                                <td>0.5 แกลลอน</td>
                                                <td>575.00</td>
                                                <td>คืนส่วนที่เหลือ</td>
                                              </tr>
                                              <tr>
                                                <td colspan="7" class="text-end fw-bold">รวมมูลค่าล็อต</td>
                                                <td class="fw-bold">1,130.00</td>
                                                <td></td>
                                              </tr>
                                            </tbody>
                                          </table>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                
                                <div class="alert alert-info mt-3">
                                  <div class="d-flex">
                                    <i class="bx bx-info-circle fs-3 me-2"></i>
                                    <div>
                                      <h6 class="mb-1">หมายเหตุเกี่ยวกับล็อตสินค้า</h6>
                                      <p class="mb-0">รายงานนี้แสดงเฉพาะ 3 ล็อตแรกจากทั้งหมด 7 ล็อตที่ใช้ในโครงการนี้ คลิกปุ่ม "ดูรายละเอียด" เพื่อดูข้อมูลทั้งหมด</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              
                              <!-- แท็บสรุปต้นทุนวัสดุ -->
                              <div class="tab-pane fade" id="summary" role="tabpanel" aria-labelledby="summaryTab">
                                <div class="row">
                                  <div class="col-md-5">
                                    <h6 class="mb-3">สรุปมูลค่าวัสดุตามหมวดหมู่</h6>
                                    <div class="table-responsive">
                                      <table class="table table-sm">
                                        <thead>
                                          <tr>
                                            <th>หมวดหมู่</th>
                                            <th class="text-end">มูลค่าเบิก</th>
                                            <th class="text-end">มูลค่าคืน</th>
                                            <th class="text-end">มูลค่าสุทธิ</th>
                                            <th class="text-end">สัดส่วน</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr>
                                            <td>วัสดุทั่วไป</td>
                                            <td class="text-end">2,350.80</td>
                                            <td class="text-end">980.50</td>
                                            <td class="text-end">1,370.30</td>
                                            <td class="text-end">52.0%</td>
                                          </tr>
                                          <tr>
                                            <td>วัสดุเครื่องมือช่าง</td>
                                            <td class="text-end">1,621.79</td>
                                            <td class="text-end">575.77</td>
                                            <td class="text-end">1,046.02</td>
                                            <td class="text-end">39.7%</td>
                                          </tr>
                                          <tr>
                                            <td>เครื่องมือช่าง</td>
                                            <td class="text-end">430.00</td>
                                            <td class="text-end">210.00</td>
                                            <td class="text-end">220.00</td>
                                            <td class="text-end">8.3%</td>
                                          </tr>
                                          <tr class="table-active">
                                            <td class="fw-bold">รวมทั้งสิ้น</td>
                                            <td class="text-end fw-bold">4,402.59</td>
                                            <td class="text-end fw-bold">1,766.27</td>
                                            <td class="text-end fw-bold">2,636.32</td>
                                            <td class="text-end fw-bold">100%</td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                  <div class="col-md-7">
                                    <h6 class="mb-3">กราฟแสดงสัดส่วนต้นทุนวัสดุ</h6>
                                    <div class="chart-container" id="materialCostChart">
                                      <!-- กราฟจะถูกสร้างด้วย ApexCharts หรือใช้รูปภาพตัวอย่างประกอบในที่นี้ -->
                                      <div class="d-flex justify-content-center align-items-center h-100">
                                        <img src="../assets/img/charts/material-cost-chart-sample.png" alt="สัดส่วนต้นทุนวัสดุ" class="img-fluid" style="max-height: 240px;">
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                
                                <div class="row mt-4">
                                  <div class="col-12">
                                    <h6 class="mb-3">การเปรียบเทียบกับโครงการอื่น</h6>
                                    <div class="table-responsive">
                                      <table class="table table-sm">
                                        <thead>
                                          <tr>
                                            <th>โครงการ</th>
                                            <th class="text-end">ราคาโครงการ</th>
                                            <th class="text-end">ต้นทุนวัสดุ</th>
                                            <th class="text-end">สัดส่วนต้นทุน</th>
                                            <th class="text-end">อัตราการคืนวัสดุ</th>
                                            <th class="text-end">ต้นทุนวัสดุ/พื้นที่</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr class="table-active">
                                            <td>จัดสวนบ้านคุณเบียร์ Parkinson</td>
                                            <td class="text-end">80,000.00</td>
                                            <td class="text-end">2,636.32</td>
                                            <td class="text-end">3.29%</td>
                                            <td class="text-end">40.12%</td>
                                            <td class="text-end">263.63/ตรม.</td>
                                          </tr>
                                          <tr>
                                            <td>โครงการสวนบ้านคุณสมชาย</td>
                                            <td class="text-end">120,000.00</td>
                                            <td class="text-end">3,840.00</td>
                                            <td class="text-end">3.20%</td>
                                            <td class="text-end">35.75%</td>
                                            <td class="text-end">320.00/ตรม.</td>
                                          </tr>
                                          <tr>
                                            <td>โครงการสวนหมู่บ้านวิลล่า</td>
                                            <td class="text-end">280,000.00</td>
                                            <td class="text-end">9,520.00</td>
                                            <td class="text-end">3.40%</td>
                                            <td class="text-end">42.30%</td>
                                            <td class="text-end">238.00/ตรม.</td>
                                          </tr>
                                          <tr>
                                            <td>ค่าเฉลี่ยทุกโครงการ</td>
                                            <td class="text-end">152,000.00</td>
                                            <td class="text-end">4,864.00</td>
                                            <td class="text-end">3.20%</td>
                                            <td class="text-end">38.50%</td>
                                            <td class="text-end">304.00/ตรม.</td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                      
                      <tr>
                        <td>P-2568-002</td>
                        <td>
                          <a href="javascript:void(0);" class="text-primary fw-semibold">จัดสวนหมู่บ้านวิลล่า</a>
                        </td>
                        <td>บริษัท วิลล่าคอนโดมิเนียม จำกัด</td>
                        <td>01/02/2568</td>
                        <td>15/04/2568</td>
                        <td><span class="status-badge status-in-progress">กำลังดำเนินการ</span></td>
                        <td>19,580.50</td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด" onclick="viewProjectDetail('P-2568-002')">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์รายงาน" onclick="printProjectReport('P-2568-002')">
                              <i class="bx bx-printer"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="ส่งออกข้อมูล" onclick="exportProjectData('P-2568-002')">
                              <i class="bx bx-export"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <tr>
                        <td>P-2568-003</td>
                        <td>
                          <a href="javascript:void(0);" class="text-primary fw-semibold">ภูมิทัศน์โรงเรียนสตรี</a>
                        </td>
                        <td>โรงเรียนสตรีวิทยา</td>
                        <td>15/01/2568</td>
                        <td>15/03/2568</td>
                        <td><span class="status-badge status-overdue">เกินกำหนด</span></td>
                        <td>28,750.75</td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด" onclick="viewProjectDetail('P-2568-003')">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์รายงาน" onclick="printProjectReport('P-2568-003')">
                              <i class="bx bx-printer"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="ส่งออกข้อมูล" onclick="exportProjectData('P-2568-003')">
                              <i class="bx bx-export"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <tr>
                        <td>P-2568-004</td>
                        <td>
                          <a href="javascript:void(0);" class="text-primary fw-semibold">จัดสวนคอนโดมิเนียม Central Park</a>
                        </td>
                        <td>บริษัท เซ็นทรัล พาร์ค จำกัด</td>
                        <td>01/03/2568</td>
                        <td>30/05/2568</td>
                        <td><span class="status-badge status-in-progress">กำลังดำเนินการ</span></td>
                        <td>32,150.25</td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด" onclick="viewProjectDetail('P-2568-004')">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์รายงาน" onclick="printProjectReport('P-2568-004')">
                              <i class="bx bx-printer"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="ส่งออกข้อมูล" onclick="exportProjectData('P-2568-004')">
                              <i class="bx bx-export"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <tr>
                        <td>P-2568-005</td>
                        <td>
                          <a href="javascript:void(0);" class="text-primary fw-semibold">จัดสวนบ้านคุณสมชาย</a>
                        </td>
                        <td>คุณสมชาย มั่งมี</td>
                        <td>15/02/2568</td>
                        <td>15/03/2568</td>
                        <td><span class="status-badge status-completed">เสร็จสิ้น</span></td>
                        <td>15,680.40</td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด" onclick="viewProjectDetail('P-2568-005')">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary me-1" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์รายงาน" onclick="printProjectReport('P-2568-005')">
                              <i class="bx bx-printer"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info" data-bs-toggle="tooltip" data-bs-placement="top" title="ส่งออกข้อมูล" onclick="exportProjectData('P-2568-005')">
                              <i class="bx bx-export"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <!-- Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div class="pagination-info">
                    แสดง 1 ถึง 5 จาก 25 โครงการ
                  </div>
                  <nav aria-label="Page navigation">
                    <ul class="pagination">
                      <li class="page-item prev">
                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-left"></i></a>
                      </li>
                      <li class="page-item active">
                        <a class="page-link" href="javascript:void(0);">1</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">2</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">3</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">4</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">5</a>
                      </li>
                      <li class="page-item next">
                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-right"></i></a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </div>
          <!-- / Content -->

          <!-- Footer -->
          <footer class="content-footer footer bg-footer-theme">
            <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
              <div class="mb-2 mb-md-0">
                © <script>
                  document.write(new Date().getFullYear())
                </script>
                , ระบบจัดสวนครบวงจร v1.0
              </div>
              <div>
                <a href="#" class="footer-link me-4">หน้าหลัก</a>
                <a href="#" class="footer-link me-4">เกี่ยวกับเรา</a>
                <a href="#" class="footer-link me-4">ช่วยเหลือ</a>
                <a href="#" class="footer-link">ติดต่อเรา</a>
              </div>
            </div>
          </footer>
          <!-- / Footer -->

          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
  </div>
  <!-- / Layout wrapper -->

  <!-- Modal เปรียบเทียบโครงการ -->
  <div class="modal fade" id="compareProjectsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">เปรียบเทียบโครงการ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="compare-checkbox-group mb-4">
            <h6 class="mb-2">เลือกโครงการที่ต้องการเปรียบเทียบ (สูงสุด 3 โครงการ)</h6>
            <div class="row">
              <div class="col-md-4">
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject1" checked>
                  <label class="form-check-label" for="compareProject1">
                    จัดสวนบ้านคุณเบียร์ Parkinson
                  </label>
                </div>
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject2" checked>
                  <label class="form-check-label" for="compareProject2">
                    จัดสวนหมู่บ้านวิลล่า
                  </label>
                </div>
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject3" checked>
                  <label class="form-check-label" for="compareProject3">
                    ภูมิทัศน์โรงเรียนสตรี
                  </label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject4">
                  <label class="form-check-label" for="compareProject4">
                    จัดสวนคอนโดมิเนียม Central Park
                  </label>
                </div>
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject5">
                  <label class="form-check-label" for="compareProject5">
                    จัดสวนบ้านคุณสมชาย
                  </label>
                </div>
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject6">
                  <label class="form-check-label" for="compareProject6">
                    ปรับปรุงภูมิทัศน์สวนสาธารณะ
                  </label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject7">
                  <label class="form-check-label" for="compareProject7">
                    สวนหย่อมสำนักงานใหญ่ ABC
                  </label>
                </div>
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject8">
                  <label class="form-check-label" for="compareProject8">
                    ปรับปรุงสวนโรงแรม Grand Paradise
                  </label>
                </div>
                <div class="compare-checkbox-item form-check">
                  <input class="form-check-input" type="checkbox" id="compareProject9">
                  <label class="form-check-label" for="compareProject9">
                    จัดสวนบ้านคุณวิชัย
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group mb-3">
            <label class="form-label">เลือกหัวข้อในการเปรียบเทียบ</label>
            <div class="row">
              <div class="col-md-6">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="compareCostValue" checked>
                  <label class="form-check-label" for="compareCostValue">
                    มูลค่าการเบิก-คืนวัสดุ
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="compareReturnRate" checked>
                  <label class="form-check-label" for="compareReturnRate">
                    อัตราการคืนวัสดุ
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="compareCostRatio" checked>
                  <label class="form-check-label" for="compareCostRatio">
                    สัดส่วนต้นทุนวัสดุต่อราคาโครงการ
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="compareMaterialCategories">
                  <label class="form-check-label" for="compareMaterialCategories">
                    สัดส่วนหมวดหมู่วัสดุ
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="compareDamageRate">
                  <label class="form-check-label" for="compareDamageRate">
                    อัตราความเสียหายของวัสดุ
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="compareCostPerArea">
                  <label class="form-check-label" for="compareCostPerArea">
                    ต้นทุนวัสดุต่อพื้นที่
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="compare-result">
            <div class="compare-title">ผลการเปรียบเทียบ</div>
            <div class="compare-description">เปรียบเทียบต้นทุนและประสิทธิภาพการใช้วัสดุระหว่าง 3 โครงการที่เลือก</div>
            
            <div class="table-responsive">
              <table class="table table-sm compare-table">
                <thead>
                  <tr>
                    <th>หัวข้อเปรียบเทียบ</th>
                    <th>จัดสวนบ้านคุณเบียร์</th>
                    <th>จัดสวนหมู่บ้านวิลล่า</th>
                    <th>ภูมิทัศน์โรงเรียนสตรี</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>ราคาโครงการ (บาท)</td>
                    <td>80,000.00</td>
                    <td>280,000.00</td>
                    <td>200,000.00</td>
                  </tr>
                  <tr>
                    <td>พื้นที่โครงการ (ตร.ม.)</td>
                    <td>10</td>
                    <td>40</td>
                    <td>80</td>
                  </tr>
                  <tr>
                    <td>มูลค่าวัสดุที่เบิก (บาท)</td>
                    <td>4,402.59</td>
                    <td>15,230.40</td>
                    <td>42,560.80</td>
                  </tr>
                  <tr>
                    <td>มูลค่าวัสดุที่คืน (บาท)</td>
                    <td>1,766.27</td>
                    <td>5,650.20</td>
                    <td>13,810.05</td>
                  </tr>
                  <tr>
                    <td>มูลค่าวัสดุสุทธิ (บาท)</td>
                    <td>2,636.32</td>
                    <td>9,580.20</td>
                    <td>28,750.75</td>
                  </tr>
                  <tr>
                    <td>อัตราการคืนวัสดุ (%)</td>
                    <td>40.12%</td>
                    <td>37.10%</td>
                    <td>32.45%</td>
                  </tr>
                  <tr>
                    <td>สัดส่วนต้นทุนวัสดุ (%)</td>
                    <td>3.29%</td>
                    <td>3.42%</td>
                    <td>14.38%</td>
                  </tr>
                  <tr>
                    <td>ต้นทุนวัสดุต่อพื้นที่ (บาท/ตร.ม.)</td>
                    <td>263.63</td>
                    <td>239.51</td>
                    <td>359.38</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="chart-container mt-3" id="compareChart">
              <!-- กราฟจะถูกสร้างด้วย ApexCharts หรือใช้รูปภาพตัวอย่างประกอบในที่นี้ -->
              <div class="d-flex justify-content-center align-items-center h-100">
                <img src="../assets/img/charts/project-compare-chart-sample.png" alt="เปรียบเทียบโครงการ" class="img-fluid" style="max-height: 240px;">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ปิด</button>
          <button type="button" class="btn btn-outline-primary" id="updateCompareBtn">
            <i class="bx bx-refresh me-1"></i> อัพเดทการเปรียบเทียบ
          </button>
          <button type="button" class="btn btn-primary" id="exportCompareBtn">
            <i class="bx bx-export me-1"></i> ส่งออกผลการเปรียบเทียบ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Detail Modal -->
  <div class="modal fade" id="projectDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">รายละเอียดโครงการ</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-0">
          <!-- เนื้อหาจะถูกโหลดด้วย AJAX หรือใช้ข้อมูลจำลองในที่นี้ -->
          <div id="projectDetailContent">
            <!-- ส่วนหัวโครงการ -->
            <div class="project-header">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">จัดสวนบ้านคุณเบียร์ Parkinson</h4>
                <span class="status-badge status-in-progress">กำลังดำเนินการ</span>
              </div>
              <p class="mb-0">รหัสโครงการ: P-2568-001 | รูปแบบงาน: งานตามสัญญา</p>
            </div>
            
            <!-- ข้อมูลโครงการ -->
            <div class="project-info">
              <div class="row mb-3">
                <div class="col-md-6">
                  <div class="project-info-item">
                    <span class="project-info-label">ลูกค้า:</span>
                    <span>คุณอริยคุณ (คุณเบียร์)</span>
                  </div>
                  <div class="project-info-item">
                    <span class="project-info-label">ผู้รับผิดชอบ:</span>
                    <span>สมศักดิ์ ช่างจัดสวน</span>
                  </div>
                  <div class="project-info-item">
                    <span class="project-info-label">ที่อยู่:</span>
                    <span>123/45 หมู่บ้านเพอร์เฟคเพลส ถ.รามคำแหง กรุงเทพฯ 10240</span>
                  </div>
                  <div class="project-info-item">
                    <span class="project-info-label">โทรศัพท์:</span>
                    <span>082-345-6789</span>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="project-info-item">
                    <span class="project-info-label">วันที่เริ่ม:</span>
                    <span>15/03/2568</span>
                  </div>
                  <div class="project-info-item">
                    <span class="project-info-label">กำหนดเสร็จ:</span>
                    <span>15/04/2568</span>
                  </div>
                  <div class="project-info-item">
                    <span class="project-info-label">ราคาโครงการ:</span>
                    <span>80,000.00 บาท</span>
                  </div>
                  <div class="project-info-item">
                    <span class="project-info-label">พื้นที่:</span>
                    <span>10 ตารางเมตร</span>
                  </div>
                </div>
              </div>
              
              <div class="project-info-item">
                <span class="project-info-label">ความคืบหน้า:</span>
                <span>65%</span>
                <div class="progress project-progress">
                  <div class="progress-bar bg-success" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
            
            <!-- แถบแท็บสำหรับเลือกดูข้อมูลต่างๆ -->
            <ul class="nav nav-tabs" id="projectTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                  ภาพรวม
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="materials-tab" data-bs-toggle="tab" data-bs-target="#materials" type="button" role="tab" aria-controls="materials" aria-selected="false">
                  รายการวัสดุ
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="lots-tab" data-bs-toggle="tab" data-bs-target="#lots" type="button" role="tab" aria-controls="lots" aria-selected="false">
                  ล็อตสินค้า
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false">
                  ประวัติการดำเนินการ
                </button>
              </li>
            </ul>
            
            <div class="tab-content" id="projectTabContent">
              <!-- แท็บภาพรวม -->
              <div class="tab-pane fade show active p-3" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-header">
                        <h6 class="card-title mb-0">สรุปมูลค่าโครงการ</h6>
                      </div>
                      <div class="card-body">
                        <div class="table-responsive">
                          <table class="table table-sm">
                            <tr>
                              <td>มูลค่าโครงการทั้งหมด</td>
                              <td class="text-end">80,000.00 บาท</td>
                            </tr>
                            <tr>
                              <td>มูลค่าวัสดุที่เบิก</td>
                              <td class="text-end">4,402.59 บาท</td>
                            </tr>
                            <tr>
                              <td>มูลค่าวัสดุที่คืน</td>
                              <td class="text-end">1,766.27 บาท</td>
                            </tr>
                            <tr>
                              <td>มูลค่าวัสดุสุทธิ</td>
                              <td class="text-end fw-bold">2,636.32 บาท</td>
                            </tr>
                            <tr>
                              <td>สัดส่วนต้นทุนวัสดุ</td>
                              <td class="text-end">3.29%</td>
                            </tr>
                            <tr>
                              <td>ต้นทุนวัสดุต่อพื้นที่</td>
                              <td class="text-end">263.63 บาท/ตร.ม.</td>
                            </tr>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-header">
                        <h6 class="card-title mb-0">ประสิทธิภาพการใช้วัสดุ</h6>
                      </div>
                      <div class="card-body">
                        <div class="mb-3">
                          <div class="d-flex justify-content-between mb-1">
                            <span>อัตราการคืนวัสดุ</span>
                            <span>40.12%</span>
                          </div>
                          <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 40.12%" aria-valuenow="40.12" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </div>
                        
                        <div class="mb-3">
                          <div class="d-flex justify-content-between mb-1">
                            <span>อัตราวัสดุที่ชำรุด/เสียหาย</span>
                            <span>5.2%</span>
                          </div>
                          <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 5.2%" aria-valuenow="5.2" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </div>
                        
                        <div class="mb-3">
                          <div class="d-flex justify-content-between mb-1">
                            <span>ประสิทธิภาพการเบิกวัสดุ</span>
                            <span>92.5%</span>
                          </div>
                          <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 92.5%" aria-valuenow="92.5" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                        </div>
                        
                        <div class="alert alert-info mt-3 mb-0">
                          <i class="bx bx-info-circle me-1"></i>
                          โครงการนี้มีอัตราการคืนวัสดุสูงกว่าค่าเฉลี่ยของโครงการทั้งหมด (40.12% เทียบกับค่าเฉลี่ย 38.50%)
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-header">
                        <h6 class="card-title mb-0">การใช้วัสดุตามหมวดหมู่</h6>
                      </div>
                      <div class="card-body">
                        <div class="chart-container" id="materialCategoryChart">
                          <!-- กราฟจะถูกสร้างด้วย ApexCharts หรือใช้รูปภาพตัวอย่างประกอบในที่นี้ -->
                          <div class="d-flex justify-content-center align-items-center h-100">
                            <img src="../assets/img/charts/material-category-chart-sample.png" alt="การใช้วัสดุตามหมวดหมู่" class="img-fluid" style="max-height: 240px;">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-header">
                        <h6 class="card-title mb-0">ไทม์ไลน์โครงการ</h6>
                      </div>
                      <div class="card-body">
                        <div class="timeline">
                          <div class="timeline-item">
                            <div class="timeline-date">15/03/2568</div>
                            <div class="timeline-title">เริ่มโครงการ</div>
                            <div class="timeline-body">ประชุมกับลูกค้าและเตรียมพื้นที่</div>
                          </div>
                          <div class="timeline-item">
                            <div class="timeline-date">20/03/2568</div>
                            <div class="timeline-title">เริ่มงานขุดและปรับพื้นที่</div>
                            <div class="timeline-body">เบิกวัสดุงวดที่ 1 จำนวน 20 รายการ</div>
                          </div>
                          <div class="timeline-item">
                            <div class="timeline-date">28/03/2568</div>
                            <div class="timeline-title">ตรวจสอบความคืบหน้า</div>
                            <div class="timeline-body">ความคืบหน้า 45% และคืนวัสดุบางส่วน</div>
                          </div>
                          <div class="timeline-item">
                            <div class="timeline-date">02/04/2568</div>
                            <div class="timeline-title">เบิกวัสดุงวดที่ 2</div>
                            <div class="timeline-body">เบิกวัสดุเพิ่มเติม 15 รายการ</div>
                          </div>
                          <div class="timeline-item">
                            <div class="timeline-date">09/04/2568</div>
                            <div class="timeline-title">ปลูกต้นไม้และตกแต่ง</div>
                            <div class="timeline-body">เริ่มงานตกแต่งและปลูกต้นไม้</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- แท็บรายการวัสดุ -->
              <div class="tab-pane fade p-3" id="materials" role="tabpanel" aria-labelledby="materials-tab">
                <div class="table-responsive">
                  <table class="table table-striped table-hover">
                    <thead>
                      <tr>
                        <th>ลำดับ</th>
                        <th>รายการ</th>
                        <th>จำนวนเบิกจริง</th>
                        <th>จำนวนคืนจริง</th>
                        <th>รวมใช้จริง</th>
                        <th>ราคาต่อหน่วย</th>
                        <th>รวมจำนวนเงินสุทธิ</th>
                        <th>หมายเหตุ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td>สีโปว๊ ขนาด 0.5 กก.</td>
                        <td>1 ถัง</td>
                        <td>-</td>
                        <td>1 ถัง</td>
                        <td>38.75</td>
                        <td>38.75</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>ทินเนอร์ขวดแก้ว</td>
                        <td>2 ขวด</td>
                        <td>-</td>
                        <td>2 ขวด</td>
                        <td>29.00</td>
                        <td>58.00</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>ใบตัดปูน 4 นิ้ว</td>
                        <td>3 ใบ</td>
                        <td>-</td>
                        <td>3 ใบ</td>
                        <td>88.00</td>
                        <td>264.00</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>4</td>
                        <td>ใบตัดเหล็ก 4 นิ้ว</td>
                        <td>3 ใบ</td>
                        <td>1 ใบ</td>
                        <td>2 ใบ</td>
                        <td>10.17</td>
                        <td>20.34</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>5</td>
                        <td>แปรงทาสีรองพื้น และสีจริง 2 นิ้ว</td>
                        <td>2 อัน</td>
                        <td>1 อัน</td>
                        <td>1 อัน</td>
                        <td>18.55</td>
                        <td>18.55</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>6</td>
                        <td>แปรงทาสีรองพื้น และสีจริง 2.1/2 นิ้ว</td>
                        <td>2 อัน</td>
                        <td>1 อัน</td>
                        <td>1 อัน</td>
                        <td>26.08</td>
                        <td>26.08</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>7</td>
                        <td>แปรงทาสีรองพื้น และสีจริง 3 นิ้ว</td>
                        <td>2 อัน</td>
                        <td>1 อัน</td>
                        <td>1 อัน</td>
                        <td>34.78</td>
                        <td>34.78</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>8</td>
                        <td>แปรงวานิช 10 ซม.</td>
                        <td>2 อัน</td>
                        <td>2 อัน</td>
                        <td>0 อัน</td>
                        <td>37.45</td>
                        <td>0.00</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>9</td>
                        <td>ลูกกลิ้งทาสี 4 นิ้ว (แบบเรียบ)</td>
                        <td>3 อัน</td>
                        <td>3 อัน</td>
                        <td>0 อัน</td>
                        <td>10.90</td>
                        <td>0.00</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>10</td>
                        <td>ลูกกลิ้งทาสี 4 นิ้ว (แบบขน)</td>
                        <td>2 อัน</td>
                        <td>2 อัน</td>
                        <td>0 อัน</td>
                        <td>16.71</td>
                        <td>0.00</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td colspan="6" class="text-end fw-bold">รวมทั้งสิ้น</td>
                        <td class="fw-bold">2,636.32</td>
                        <td></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div class="pagination-info">
                    แสดง 1 ถึง 10 จาก 35 รายการ
                  </div>
                  <nav aria-label="Page navigation">
                    <ul class="pagination pagination-sm">
                      <li class="page-item prev">
                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-left"></i></a>
                      </li>
                      <li class="page-item active">
                        <a class="page-link" href="javascript:void(0);">1</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">2</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">3</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">4</a>
                      </li>
                      <li class="page-item next">
                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-right"></i></a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
              
              <!-- แท็บล็อตสินค้า -->
              <div class="tab-pane fade p-3" id="lots" role="tabpanel" aria-labelledby="lots-tab">
                <div class="accordion" id="modalLotAccordion">
                  <!-- ล็อตที่ 1 -->
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="modalLotHeading1">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#modalLotCollapse1" aria-expanded="true" aria-controls="modalLotCollapse1">
                        <div>
                          <span class="fw-bold">ล็อต: LOT-20240301-A</span>
                          <div class="text-muted small">วันที่รับเข้า: 01/03/2568 | ผู้จำหน่าย: บริษัท ABC วัสดุก่อสร้าง</div>
                        </div>
                      </button>
                    </h2>
                    <div id="modalLotCollapse1" class="accordion-collapse collapse show" aria-labelledby="modalLotHeading1" data-bs-parent="#modalLotAccordion">
                      <div class="accordion-body p-0">
                        <div class="table-responsive">
                          <table class="table table-sm table-hover mb-0">
                            <thead>
                              <tr>
                                <th>ลำดับ</th>
                                <th>รหัสสินค้า</th>
                                <th>รายการ</th>
                                <th>ราคา/หน่วย</th>
                                <th>เบิกจริง</th>
                                <th>คืนจริง</th>
                                <th>ใช้จริง</th>
                                <th>รวมเงินสุทธิ</th>
                                <th>หมายเหตุ</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>1</td>
                                <td>PT-001</td>
                                <td>สีโปว๊ ขนาด 0.5 กก.</td>
                                <td>38.75</td>
                                <td>1 ถัง</td>
                                <td>-</td>
                                <td>1 ถัง</td>
                                <td>38.75</td>
                                <td>-</td>
                              </tr>
                              <tr>
                                <td>2</td>
                                <td>TN-001</td>
                                <td>ทินเนอร์ขวดแก้ว</td>
                                <td>29.00</td>
                                <td>2 ขวด</td>
                                <td>-</td>
                                <td>2 ขวด</td>
                                <td>58.00</td>
                                <td>-</td>
                              </tr>
                              <tr>
                                <td>3</td>
                                <td>CT-001</td>
                                <td>ใบตัดปูน 4 นิ้ว</td>
                                <td>88.00</td>
                                <td>3 ใบ</td>
                                <td>-</td>
                                <td>3 ใบ</td>
                                <td>264.00</td>
                                <td>-</td>
                              </tr>
                              <tr>
                                <td colspan="7" class="text-end fw-bold">รวมมูลค่าล็อต</td>
                                <td class="fw-bold">360.75</td>
                                <td></td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- ล็อตที่ 2 -->
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="modalLotHeading2">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#modalLotCollapse2" aria-expanded="false" aria-controls="modalLotCollapse2">
                        <div>
                          <span class="fw-bold">ล็อต: LOT-20240225-B</span>
                          <div class="text-muted small">วันที่รับเข้า: 25/02/2568 | ผู้จำหน่าย: บริษัท XYZ การก่อสร้าง</div>
                        </div>
                      </button>
                    </h2>
                    <div id="modalLotCollapse2" class="accordion-collapse collapse" aria-labelledby="modalLotHeading2" data-bs-parent="#modalLotAccordion">
                      <div class="accordion-body p-0">
                        <div class="table-responsive">
                          <table class="table table-sm table-hover mb-0">
                            <thead>
                              <tr>
                                <th>ลำดับ</th>
                                <th>รหัสสินค้า</th>
                                <th>รายการ</th>
                                <th>ราคา/หน่วย</th>
                                <th>เบิกจริง</th>
                                <th>คืนจริง</th>
                                <th>ใช้จริง</th>
                                <th>รวมเงินสุทธิ</th>
                                <th>หมายเหตุ</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>1</td>
                                <td>CT-002</td>
                                <td>ใบตัดเหล็ก 4 นิ้ว</td>
                                <td>10.17</td>
                                <td>3 ใบ</td>
                                <td>1 ใบ</td>
                                <td>2 ใบ</td>
                                <td>20.34</td>
                                <td>คืนเนื่องจากไม่ได้ใช้</td>
                              </tr>
                              <tr>
                                <td>2</td>
                                <td>BR-001</td>
                                <td>แปรงทาสีรองพื้น และสีจริง 2 นิ้ว</td>
                                <td>18.55</td>
                                <td>2 อัน</td>
                                <td>1 อัน</td>
                                <td>1 อัน</td>
                                <td>18.55</td>
                                <td>-</td>
                              </tr>
                              <tr>
                                <td>3</td>
                                <td>BR-002</td>
                                <td>แปรงทาสีรองพื้น และสีจริง 2.1/2 นิ้ว</td>
                                <td>26.08</td>
                                <td>2 อัน</td>
                                <td>1 อัน</td>
                                <td>1 อัน</td>
                                <td>26.08</td>
                                <td>-</td>
                              </tr>
                              <tr>
                                <td colspan="7" class="text-end fw-bold">รวมมูลค่าล็อต</td>
                                <td class="fw-bold">64.97</td>
                                <td></td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- แท็บประวัติการดำเนินการ -->
              <div class="tab-pane fade p-3" id="history" role="tabpanel" aria-labelledby="history-tab">
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th style="width: 180px;">วันที่-เวลา</th>
                        <th style="width: 200px;">ประเภทรายการ</th>
                        <th>รายละเอียด</th>
                        <th style="width: 180px;">ผู้ดำเนินการ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>15/03/2568 09:00</td>
                        <td>เริ่มโครงการ</td>
                        <td>สร้างโครงการใหม่และกำหนดขอบเขตงาน</td>
                        <td>บุญชัย ผู้จัดการ</td>
                      </tr>
                      <tr>
                        <td>20/03/2568 08:30</td>
                        <td>เบิกวัสดุ</td>
                        <td>เบิกวัสดุงวดที่ 1 จำนวน 20 รายการ มูลค่า 3,250.40 บาท</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                      </tr>
                      <tr>
                        <td>28/03/2568 14:15</td>
                        <td>อัพเดทความคืบหน้า</td>
                        <td>บันทึกความคืบหน้าโครงการ 45% และคืนวัสดุบางส่วน</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                      </tr>
                      <tr>
                        <td>28/03/2568 15:30</td>
                        <td>คืนวัสดุ</td>
                        <td>คืนวัสดุบางส่วนจากงวดที่ 1 จำนวน 8 รายการ มูลค่า 1,150.80 บาท</td>
                        <td>สมหญิง พนักงานคลัง</td>
                      </tr>
                      <tr>
                        <td>02/04/2568 09:45</td>
                        <td>เบิกวัสดุ</td>
                        <td>เบิกวัสดุงวดที่ 2 จำนวน 15 รายการ มูลค่า 1,152.19 บาท</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                      </tr>
                      <tr>
                        <td>05/04/2568 10:30</td>
                        <td>คืนวัสดุ</td>
                        <td>คืนวัสดุบางส่วนจากงวดที่ 2 จำนวน 6 รายการ มูลค่า 615.47 บาท</td>
                        <td>สมหญิง พนักงานคลัง</td>
                      </tr>
                      <tr>
                        <td>09/04/2568 13:20</td>
                        <td>อัพเดทความคืบหน้า</td>
                        <td>บันทึกความคืบหน้าโครงการ 65% และเริ่มงานตกแต่งและปลูกต้นไม้</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ปิด</button>
          <button type="button" class="btn btn-outline-primary" id="printModalBtn">
            <i class="bx bx-printer me-1"></i> พิมพ์รายงาน
          </button>
          <button type="button" class="btn btn-primary" id="exportModalBtn">
            <i class="bx bx-export me-1"></i> ส่งออกข้อมูล
          </button>
        </div>
      </div>
    </div>
  </div>
<!-- PDF Preview Modal -->
<div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">ตัวอย่างรายงาน PDF</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0 d-flex justify-content-center">
        <iframe id="pdfPreviewFrame" src="" style="width:100%; height:calc(100vh - 200px);" frameborder="0"></iframe>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" value="" id="includeDetailedMaterials" checked>
            <label class="form-check-label" for="includeDetailedMaterials">
              รวมรายละเอียดวัสดุทั้งหมด
            </label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" value="" id="includeTimeline" checked>
            <label class="form-check-label" for="includeTimeline">
              แสดงไทม์ไลน์โครงการ
            </label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" value="" id="includeCharts" checked>
            <label class="form-check-label" for="includeCharts">
              แสดงกราฟต่างๆ
            </label>
          </div>
        </div>
        <div>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ปิด</button>
          <button type="button" class="btn btn-outline-primary" id="printPdfBtn">
            <i class="bx bx-printer me-1"></i> พิมพ์
          </button>
          <button type="button" class="btn btn-primary" id="downloadPdfBtn">
            <i class="bx bx-download me-1"></i> ดาวน์โหลด PDF
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PDF Generation Loading Modal -->
<div class="modal fade" id="pdfLoadingModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center p-5">
        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">กำลังสร้าง PDF...</span>
        </div>
        <h5 class="mb-2">กำลังสร้างไฟล์ PDF</h5>
        <p class="mb-0 text-muted">โปรดรอสักครู่...</p>
      </div>
    </div>
  </div>
</div>
  <!-- Core JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>

  <!-- Vendors JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.41.0/apexcharts.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Page JS -->
  <script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize Flatpickr for date inputs
  flatpickr(".flatpickr-date", {
      dateFormat: "d/m/Y"
  });

  // Initialize Select2 for dropdowns
  $('.form-select').select2({
      width: '100%'
  });

  // Initialize DataTables with correct configuration
  $('#projectsTable').DataTable({
      // Disable DataTables' automatic detection of columns
      // This prevents the warning when we have complex table structures
      autoWidth: false,
      
      // Properly handle collapsed rows
      columnDefs: [
      { orderable: false, targets: -1 } // Disable ordering on the last column (actions)
      ],
      
      // The rest of your configuration
      dom: '<"d-flex justify-content-between align-items-center mb-3"lf>rt<"d-flex justify-content-between align-items-center mt-3"ip>',
      language: {
      search: "ค้นหา:",
      lengthMenu: "แสดง _MENU_ รายการ",
      zeroRecords: "ไม่พบข้อมูล",
      info: "แสดง _START_ ถึง _END_ จาก _TOTAL_ รายการ",
      infoEmpty: "แสดง 0 ถึง 0 จาก 0 รายการ",
      infoFiltered: "(กรองจากทั้งหมด _MAX_ รายการ)",
      paginate: {
          first: "หน้าแรก",
          last: "หน้าสุดท้าย",
          next: "ถัดไป",
          previous: "ก่อนหน้า"
      }
      },
      pageLength: 5,
      lengthMenu: [5, 10, 25, 50, 100],
      ordering: true,
      responsive: true,
      
      // Crucial fix: Handle collapse rows properly
      // This prevents DataTables from trying to process hidden/collapsed rows
      rowGroup: {
      dataSrc: function(row) {
          // Skip processing rows with class 'collapse'
          if ($(row.node()).hasClass('collapse')) {
          return '';
          }
          return '';
      }
      },
      
      // Initialize the table only when it's ready
      initComplete: function() {
      console.log('DataTable initialized successfully');
      }
  });

  // Initialize tooltips
  const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
  const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

  // The rest of your JavaScript remains the same...
});
            // แก้ไขการแสดงผลเมนู
function initializeMenu() {
    // ปรับการแสดงผลเมนูย่อยเมื่อคลิกที่เมนูหลัก
    const menuToggles = document.querySelectorAll('.menu-toggle');
    menuToggles.forEach(toggle => {
    toggle.addEventListener('click', function(e) {
        e.preventDefault();
        const menuItem = this.closest('.menu-item');
        const menuSub = menuItem.querySelector('.menu-sub');
        
        // Toggle active และ open classes
        menuItem.classList.toggle('active');
        menuItem.classList.toggle('open');
        
        // แสดง/ซ่อนเมนูย่อย
        if (menuSub.style.display === 'block') {
        menuSub.style.display = 'none';
        } else {
        menuSub.style.display = 'block';
        }
    });
    });
}
            
// เรียกใช้ฟังก์ชันจัดการเมนู
initializeMenu();

// ฟังก์ชันสำหรับดูรายละเอียดโครงการ
window.viewProjectDetail = function(projectId) {
    console.log('ดูรายละเอียดโครงการ: ' + projectId);
    
    // แสดง Modal รายละเอียดโครงการ
    $('#projectDetailModal').modal('show');
    
    // ในระบบจริงควรโหลดข้อมูลจาก API ตาม projectId ที่ได้รับ
    // ตัวอย่างนี้แสดงข้อมูลจำลองเท่านั้น
};
            
// ฟังก์ชันสำหรับพิมพ์รายงานโครงการ
window.printProjectReport = function(projectId) {
    console.log('พิมพ์รายงานโครงการ: ' + projectId);
    
    // แสดง Loading Modal
    const loadingModal = new bootstrap.Modal(document.getElementById('pdfLoadingModal'));
    loadingModal.show();
    
    // เพิ่ม setTimeout เพื่อให้ Loading Modal แสดงก่อนที่จะเริ่มทำงานหนัก
    setTimeout(function() {
        try {
            // สร้าง PDF
            const doc = generateProjectPDF(projectId);
            
            // เปิด PDF ในแท็บใหม่และสั่งพิมพ์
            const pdfDataUri = doc.output('datauristring');
            const printWindow = window.open(pdfDataUri);
            
            // รอให้ PDF โหลดเสร็จแล้วสั่งพิมพ์
            printWindow.addEventListener('load', function() {
                setTimeout(function() {
                    printWindow.print();
                    loadingModal.hide();
                }, 500);
            });
        } catch (error) {
            console.error('เกิดข้อผิดพลาดในการพิมพ์ PDF:', error);
            alert('เกิดข้อผิดพลาดในการพิมพ์ PDF โปรดลองอีกครั้ง');
            loadingModal.hide();
        }
    }, 100);
};;

// ฟังก์ชันสำหรับส่งออกข้อมูลโครงการ
window.exportProjectData = function(projectId) {
    console.log('ส่งออกข้อมูลโครงการ: ' + projectId);
    
    // แสดง Loading Modal
    const loadingModal = new bootstrap.Modal(document.getElementById('pdfLoadingModal'));
    loadingModal.show();
    
    // เพิ่ม setTimeout เพื่อให้ Loading Modal แสดงก่อนที่จะเริ่มทำงานหนัก
    setTimeout(function() {
        try {
            // สร้าง PDF
            generateProjectPDF(projectId);
        } catch (error) {
            console.error('เกิดข้อผิดพลาดในการสร้าง PDF:', error);
            alert('เกิดข้อผิดพลาดในการสร้าง PDF โปรดลองอีกครั้ง');
            loadingModal.hide();
        }
    }, 100);
};

// ปุ่มรีเซ็ตตัวกรอง
document.getElementById('resetFilterBtn').addEventListener('click', function() {
    document.getElementById('projectSearch').value = '';
    document.getElementById('projectStatus').value = '';
    document.getElementById('projectStartDate').value = '';
    document.getElementById('projectEndDate').value = '';
    
    // รีเซ็ต Select2
    $('#projectStatus').val('').trigger('change');
});

// ปุ่มค้นหา
document.getElementById('searchBtn').addEventListener('click', function() {
    // จำลองการค้นหา
    alert('กำลังค้นหาโครงการตามเงื่อนไขที่กำหนด');
});

// ปุ่มพิมพ์รายงาน (จาก Modal)
document.getElementById('printModalBtn').addEventListener('click', function() {
    // จำลองการพิมพ์
    alert('กำลังเตรียมพิมพ์รายละเอียดโครงการ');
});

// ปุ่มส่งออกข้อมูล (จาก Modal)
document.getElementById('exportModalBtn').addEventListener('click', function() {
    // จำลองการส่งออก
    alert('กำลังเตรียมไฟล์ส่งออกรายละเอียดโครงการ');
});

// ปุ่มอัพเดทการเปรียบเทียบ
document.getElementById('updateCompareBtn').addEventListener('click', function() {
    // จำลองการอัพเดท
    alert('กำลังอัพเดทข้อมูลการเปรียบเทียบ');
});

// ปุ่มส่งออกผลการเปรียบเทียบ
document.getElementById('exportCompareBtn').addEventListener('click', function() {
    // จำลองการส่งออก
    alert('กำลังเตรียมไฟล์ส่งออกผลการเปรียบเทียบ');
});

// ปุ่มพิมพ์ (จากหน้าหลัก)
document.getElementById('printReport').addEventListener('click', function() {
    // จำลองการพิมพ์
    alert('กำลังเตรียมพิมพ์รายงานโครงการทั้งหมด');
});

// ปุ่มส่งออก PDF
document.getElementById('exportPDF').addEventListener('click', function() {
    // จำลองการส่งออกเป็น PDF
    alert('กำลังส่งออกรายงานในรูปแบบ PDF');
});

// ปุ่มส่งออก Excel
document.getElementById('exportExcel').addEventListener('click', function() {
    // จำลองการส่งออกเป็น Excel
    alert('กำลังส่งออกรายงานในรูปแบบ Excel');
});

// ปุ่มส่งออก CSV
document.getElementById('exportCSV').addEventListener('click', function() {
    // จำลองการส่งออกเป็น CSV
    alert('กำลังส่งออกรายงานในรูปแบบ CSV');
});

// ฟังก์ชันสำหรับสร้างกราฟ
function initializeCharts() {
    // ในระบบจริงควรสร้างกราฟด้วย ApexCharts หรือ Chart.js
    console.log('Initialize charts');
}
          
// เรียกใช้ฟังก์ชันสร้างกราฟ
setTimeout(initializeCharts, 500);

    
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////








// ฟังก์ชันสำหรับสร้าง PDF ของโครงการ
function generateProjectPDF(projectId) {
  // ตรวจสอบว่ามีการโหลด jsPDF แล้วหรือไม่
  if (typeof jspdf === 'undefined') {
    console.error('jsPDF library is not loaded');
    alert('ไม่สามารถสร้าง PDF ได้ กรุณาโหลดหน้านี้ใหม่');
    return;
  }
  
  // สร้างเอกสาร PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({
    orientation: 'portrait',
    unit: 'mm',
    format: 'a4'
  });

  // ค้นหาข้อมูลโครงการจาก projectId
  // ในตัวอย่างนี้เราจะใช้ข้อมูลจำลอง
  const projectData = getProjectData(projectId);
  
  if (!projectData) {
    alert('ไม่พบข้อมูลโครงการ');
    return;
  }
  
  // ====== สร้างเอกสาร PDF ======
  
  // 1. หัวเอกสาร
  addPDFHeader(doc, projectData);
  
  // 2. ข้อมูลโครงการ
  addProjectInfo(doc, projectData);
  
  // 3. สรุปการเงิน
  addFinancialSummary(doc, projectData);
  
  // 4. รายการวัสดุที่ใช้
  addMaterialList(doc, projectData);
  
  // 5. ความคืบหน้าโครงการ
  addProjectProgress(doc, projectData);
  
  // 6. เพิ่มหมายเลขหน้า
  addPageNumbers(doc);
  
  // แสดงตัวอย่าง PDF ใน Modal
  showPDFPreview(doc, projectData.name);
  
  return doc; // ส่งคืนอ็อบเจ็กต์ PDF เพื่อใช้งานต่อ
}

// เพิ่มส่วนหัวเอกสาร
function addPDFHeader(doc, projectData) {
  // เพิ่มโลโก้ (สมมติว่ามีรูปโลโก้)
  // ในโค้ดที่สมบูรณ์ คุณควรโหลดรูปโลโก้จริง
  doc.setFillColor(40, 167, 69); // สีเขียว
  doc.rect(15, 15, 10, 10, 'F');
  
  // เพิ่มชื่อบริษัท
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(18);
  doc.text('Green Gardens', 105, 20, { align: 'center' });
  
  // เพิ่มวันที่พิมพ์รายงาน
  const today = new Date();
  const dateStr = today.toLocaleDateString('th-TH', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(`วันที่พิมพ์: ${dateStr}`, 195, 20, { align: 'right' });
  
  // เพิ่มชื่อรายงาน
  doc.setFontSize(16);
  doc.setFont('helvetica', 'bold');
  doc.text('รายงานโครงการ', 105, 30, { align: 'center' });
  
  // เส้นคั่น
  doc.setDrawColor(220, 220, 220);
  doc.setLineWidth(0.5);
  doc.line(15, 35, 195, 35);
}

// เพิ่มข้อมูลโครงการ
function addProjectInfo(doc, projectData) {
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text('ข้อมูลโครงการ', 15, 45);
  
  doc.setFontSize(11);
  doc.setFont('helvetica', 'normal');
  
  // ข้อมูลพื้นฐานโครงการ
  const startY = 55;
  const lineHeight = 7;
  
  doc.setFont('helvetica', 'bold');
  doc.text('รหัสโครงการ:', 15, startY);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.id, 50, startY);
  
  doc.setFont('helvetica', 'bold');
  doc.text('ชื่อโครงการ:', 15, startY + lineHeight);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.name, 50, startY + lineHeight);
  
  doc.setFont('helvetica', 'bold');
  doc.text('ลูกค้า:', 15, startY + lineHeight * 2);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.customer, 50, startY + lineHeight * 2);
  
  doc.setFont('helvetica', 'bold');
  doc.text('วันที่เริ่ม:', 15, startY + lineHeight * 3);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.startDate, 50, startY + lineHeight * 3);
  
  doc.setFont('helvetica', 'bold');
  doc.text('กำหนดเสร็จ:', 15, startY + lineHeight * 4);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.endDate, 50, startY + lineHeight * 4);
  
  doc.setFont('helvetica', 'bold');
  doc.text('สถานะ:', 115, startY);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.status, 150, startY);
  
  doc.setFont('helvetica', 'bold');
  doc.text('ความคืบหน้า:', 115, startY + lineHeight);
  doc.setFont('helvetica', 'normal');
  doc.text(`${projectData.progress}%`, 150, startY + lineHeight);
  
  doc.setFont('helvetica', 'bold');
  doc.text('ผู้รับผิดชอบ:', 115, startY + lineHeight * 2);
  doc.setFont('helvetica', 'normal');
  doc.text(projectData.owner, 150, startY + lineHeight * 2);
  
  // เส้นคั่น
  doc.setDrawColor(220, 220, 220);
  doc.setLineWidth(0.5);
  doc.line(15, startY + lineHeight * 5, 195, startY + lineHeight * 5);
}

// เพิ่มสรุปการเงิน
function addFinancialSummary(doc, projectData) {
  const startY = 95;
  const lineHeight = 7;
  
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text('สรุปการเงิน', 15, startY);
  
  doc.setFontSize(11);
  
  // สร้างตารางสรุปการเงิน
  const financialData = [
    ['รายการ', 'จำนวนเงิน (บาท)'],
    ['ราคาโครงการทั้งหมด', projectData.budget.toLocaleString()],
    ['มูลค่าวัสดุที่เบิก', projectData.materialCost.toLocaleString()],
    ['มูลค่าวัสดุที่คืน', projectData.materialReturnCost.toLocaleString()],
    ['มูลค่าวัสดุสุทธิ', projectData.materialNetCost.toLocaleString()],
    ['สัดส่วนต้นทุนวัสดุ', `${projectData.materialCostRatio}%`],
    ['ต้นทุนวัสดุต่อพื้นที่', `${projectData.costPerArea} บาท/ตร.ม.`]
  ];
  
  // วาดตาราง
  doc.autoTable({
    startY: startY + 5,
    head: [financialData[0]],
    body: financialData.slice(1),
    theme: 'grid',
    headStyles: {
      fillColor: [40, 167, 69], // สีเขียว
      textColor: [255, 255, 255],
      fontStyle: 'bold'
    },
    styles: {
      fontSize: 10,
      cellPadding: 3
    },
    columnStyles: {
      0: { cellWidth: 100 },
      1: { cellWidth: 60, halign: 'right' }
    },
    margin: { left: 15, right: 15 }
  });
}

// เพิ่มรายการวัสดุที่ใช้
function addMaterialList(doc, projectData) {
  const startY = doc.lastAutoTable.finalY + 15;
  
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text('รายการวัสดุที่ใช้', 15, startY);
  
  doc.setFontSize(11);
  
  // สร้างตารางรายการวัสดุ
  const header = [['ลำดับ', 'รายการ', 'จำนวนเบิกจริง', 'จำนวนคืนจริง', 'รวมใช้จริง', 'ราคาต่อหน่วย', 'รวมจำนวนเงินสุทธิ']];
  
  // สร้างข้อมูลจำลอง
  let materialRows = [];
  if (projectData.materials && projectData.materials.length > 0) {
    materialRows = projectData.materials.map((item, index) => [
      (index + 1).toString(),
      item.name,
      `${item.quantityWithdrawn} ${item.unit}`,
      item.quantityReturned ? `${item.quantityReturned} ${item.unit}` : '-',
      `${item.quantityUsed} ${item.unit}`,
      item.unitPrice.toLocaleString(),
      item.totalCost.toLocaleString()
    ]);
  }
  
  // เพิ่มแถวรวม
  materialRows.push([
    '', 'รวมทั้งสิ้น', '', '', '', '', 
    projectData.materialNetCost.toLocaleString()
  ]);
  
  // วาดตาราง
  doc.autoTable({
    startY: startY + 5,
    head: header,
    body: materialRows,
    theme: 'grid',
    headStyles: {
      fillColor: [40, 167, 69], // สีเขียว
      textColor: [255, 255, 255],
      fontStyle: 'bold'
    },
    styles: {
      fontSize: 9,
      cellPadding: 2
    },
    columnStyles: {
      0: { cellWidth: 10, halign: 'center' },
      2: { cellWidth: 25, halign: 'center' },
      3: { cellWidth: 25, halign: 'center' },
      4: { cellWidth: 25, halign: 'center' },
      5: { cellWidth: 25, halign: 'right' },
      6: { cellWidth: 35, halign: 'right' }
    },
    margin: { left: 15, right: 15 },
    didParseCell: function(data) {
      // จัดรูปแบบแถวสุดท้าย (รวมทั้งสิ้น)
      if (data.row.index === materialRows.length - 1) {
        data.cell.styles.fontStyle = 'bold';
        if (data.column.index === 0) {
          data.cell.colSpan = 6;
          data.cell.styles.halign = 'right';
          data.cell.text = ['รวมทั้งสิ้น'];
        }
      }
    }
  });
  
  // หากตารางยาวเกินหน้า ให้เพิ่มหน้าใหม่
  if (doc.lastAutoTable.finalY > 250) {
    doc.addPage();
  }
}

// เพิ่มความคืบหน้าโครงการ
function addProjectProgress(doc, projectData) {
  const startY = doc.lastAutoTable.finalY + 15;
  
  // ตรวจสอบว่าต้องขึ้นหน้าใหม่หรือไม่
  if (startY > 230) {
    doc.addPage();
    startY = 20;
  }
  
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text('ความคืบหน้าโครงการ', 15, startY);
  
  doc.setFontSize(11);
  doc.setFont('helvetica', 'normal');
  doc.text('ไทม์ไลน์โครงการ', 15, startY + 10);
  
  // สร้างตารางไทม์ไลน์
  const timelineHeader = [['วันที่', 'กิจกรรม', 'รายละเอียด']];
  
  // สร้างข้อมูลจำลอง
  let timelineRows = [];
  if (projectData.timeline && projectData.timeline.length > 0) {
    timelineRows = projectData.timeline.map(item => [
      item.date,
      item.title,
      item.description
    ]);
  }
  
  // วาดตาราง
  doc.autoTable({
    startY: startY + 15,
    head: timelineHeader,
    body: timelineRows,
    theme: 'grid',
    headStyles: {
      fillColor: [40, 167, 69], // สีเขียว
      textColor: [255, 255, 255],
      fontStyle: 'bold'
    },
    styles: {
      fontSize: 9,
      cellPadding: 3
    },
    columnStyles: {
      0: { cellWidth: 25 },
      1: { cellWidth: 40 }
    },
    margin: { left: 15, right: 15 }
  });
  
  // เพิ่มข้อมูลสรุปหมวดหมู่วัสดุ
  if (doc.lastAutoTable.finalY + 60 > 280) {
    doc.addPage();
    drawMaterialCategoryChart(doc, 20, projectData);
  } else {
    drawMaterialCategoryChart(doc, doc.lastAutoTable.finalY + 15, projectData);
  }
}

// วาดกราฟสรุปหมวดหมู่วัสดุ (แบบจำลอง)
function drawMaterialCategoryChart(doc, startY, projectData) {
  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text('สัดส่วนหมวดหมู่วัสดุ', 15, startY);
  
  // สร้างข้อมูลจำลองสำหรับแสดงกราฟวงกลม
  const categories = [
    { name: 'วัสดุทั่วไป', value: 52.0, color: [40, 167, 69] },
    { name: 'วัสดุเครื่องมือช่าง', value: 39.7, color: [66, 165, 245] },
    { name: 'เครื่องมือช่าง', value: 8.3, color: [255, 167, 38] }
  ];
  
  // วาดกราฟวงกลมอย่างง่าย
  const centerX = 50;
  const centerY = startY + 45;
  const radius = 30;
  
  let startAngle = 0;
  for (let i = 0; i < categories.length; i++) {
    const category = categories[i];
    const endAngle = startAngle + (category.value / 100) * 2 * Math.PI;
    
    // วาดส่วนของวงกลม
    doc.setFillColor(category.color[0], category.color[1], category.color[2]);
    doc.setDrawColor(255, 255, 255);
    doc.setLineWidth(0.5);
    
    // วาดเส้นโค้ง
    doc.circle(centerX, centerY, radius, 'S');
    doc.setFillColor(category.color[0], category.color[1], category.color[2]);
    
    // แสดงคำอธิบาย
    doc.setFillColor(category.color[0], category.color[1], category.color[2]);
    doc.rect(100, startY + 30 + i * 10, 5, 5, 'F');
    
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(9);
    doc.text(`${category.name}: ${category.value}%`, 110, startY + 34 + i * 10);
    
    startAngle = endAngle;
  }
}

// เพิ่มหมายเลขหน้า
function addPageNumbers(doc) {
  const pageCount = doc.internal.getNumberOfPages();
  
  for (let i = 1; i <= pageCount; i++) {
    doc.setPage(i);
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.text(`หน้า ${i} จาก ${pageCount}`, 105, 290, { align: 'center' });
  }
}

// แสดงตัวอย่าง PDF ใน Modal
function showPDFPreview(doc, projectName) {
  // สร้าง data URL ของ PDF
  const pdfDataUri = doc.output('datauristring');
  
  // สร้างหรือปรับปรุง Modal
  let previewModal = document.getElementById('pdfPreviewModal');
  
  if (!previewModal) {
    // สร้าง Modal ใหม่
    const modalHtml = `
      <div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title">ตัวอย่างรายงาน: ${projectName}</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0 d-flex justify-content-center">
              <iframe id="pdfPreviewFrame" src="" style="width:100%; height:calc(100vh - 200px);" frameborder="0"></iframe>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="includeDetailedMaterials" checked>
                <label class="form-check-label" for="includeDetailedMaterials">
                  รวมรายละเอียดวัสดุทั้งหมด
                </label>
              </div>
              <div>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ปิด</button>
                <button type="button" class="btn btn-primary" id="downloadPdfBtn">
                  <i class="bx bx-download me-1"></i> ดาวน์โหลด PDF
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    previewModal = document.getElementById('pdfPreviewModal');
    
    // เพิ่ม Event Listener สำหรับปุ่มดาวน์โหลด
    document.getElementById('downloadPdfBtn').addEventListener('click', function() {
      const includeDetails = document.getElementById('includeDetailedMaterials').checked;
      
      // สร้าง PDF ใหม่ตามตัวเลือกที่เลือก
      const downloadDoc = regeneratePDF(projectName, includeDetails);
      
      // ดาวน์โหลด PDF
      downloadDoc.save(`รายงานโครงการ_${projectName}.pdf`);
    });
  } else {
    // อัพเดทชื่อโครงการในหัวข้อ Modal
    previewModal.querySelector('.modal-title').textContent = `ตัวอย่างรายงาน: ${projectName}`;
  }
  
  // อัพเดท src ของ iframe
  const previewFrame = document.getElementById('pdfPreviewFrame');
  previewFrame.src = pdfDataUri;
  
  // แสดง Modal
  const bsModal = new bootstrap.Modal(previewModal);
  bsModal.show();
}

// สร้าง PDF ใหม่ตามตัวเลือกที่เลือก
function regeneratePDF(projectName, includeDetails) {
  // ในตัวอย่างนี้ เราจะส่งคืน PDF เดิม
  // แต่ในการใช้งานจริง คุณควรสร้าง PDF ใหม่ตามตัวเลือกที่เลือก
  const projectId = document.getElementById('modal-project-id').textContent;
  return generateProjectPDF(projectId);
}

// ฟังก์ชันสมมติสำหรับดึงข้อมูลโครงการ
function getProjectData(projectId) {
  // ในการใช้งานจริง คุณควรดึงข้อมูลจากฐานข้อมูลหรือ API
  // แต่ในตัวอย่างนี้ เราจะใช้ข้อมูลจำลอง
  
  // ข้อมูลจำลองสำหรับ P-2568-001
  if (projectId === 'P-2568-001') {
    return {
      id: 'P-2568-001',
      name: 'สวนหย่อมบ้านคุณสมชาย',
      customer: 'สมชาย มีทรัพย์',
      startDate: '05/03/2568',
      endDate: '05/04/2568',
      status: 'กำลังดำเนินการ',
      progress: 60,
      owner: 'นายชัยณรงค์ สวนสวย',
      budget: 80000,
      materialCost: 4402.59,
      materialReturnCost: 1766.27,
      materialNetCost: 2636.32,
      materialCostRatio: 3.29,
      costPerArea: 263.63,
      materials: [
        { name: 'สีโปว๊ ขนาด 0.5 กก.', quantityWithdrawn: 1, unit: 'ถัง', quantityReturned: 0, quantityUsed: 1, unitPrice: 38.75, totalCost: 38.75 },
        { name: 'ทินเนอร์ขวดแก้ว', quantityWithdrawn: 2, unit: 'ขวด', quantityReturned: 0, quantityUsed: 2, unitPrice: 29.00, totalCost: 58.00 },
        { name: 'ใบตัดปูน 4 นิ้ว', quantityWithdrawn: 3, unit: 'ใบ', quantityReturned: 0, quantityUsed: 3, unitPrice: 88.00, totalCost: 264.00 },
        { name: 'ใบตัดเหล็ก 4 นิ้ว', quantityWithdrawn: 3, unit: 'ใบ', quantityReturned: 1, quantityUsed: 2, unitPrice: 10.17, totalCost: 20.34 },
        { name: 'แปรงทาสีรองพื้น และสีจริง 2 นิ้ว', quantityWithdrawn: 2, unit: 'อัน', quantityReturned: 1, quantityUsed: 1, unitPrice: 18.55, totalCost: 18.55 }
      ],
      timeline: [
        { date: '15/03/2568', title: 'เริ่มโครงการ', description: 'ประชุมกับลูกค้าและเตรียมพื้นที่' },
        { date: '20/03/2568', title: 'เริ่มงานขุดและปรับพื้นที่', description: 'เบิกวัสดุงวดที่ 1 จำนวน 20 รายการ' },
        { date: '28/03/2568', title: 'ตรวจสอบความคืบหน้า', description: 'ความคืบหน้า 45% และคืนวัสดุบางส่วน' },
        { date: '02/04/2568', title: 'เบิกวัสดุงวดที่ 2', description: 'เบิกวัสดุเพิ่มเติม 15 รายการ' }
      ]
    };
  }
  
  // ข้อมูลจำลองสำหรับโครงการอื่นๆ (ย่อ)
  return {
    id: projectId,
    name: 'โครงการตัวอย่าง',
    customer: 'ลูกค้าตัวอย่าง',
    startDate: '01/01/2568',
    endDate: '31/01/2568',
    status: 'กำลังดำเนินการ',
    progress: 50,
    owner: 'ผู้รับผิดชอบตัวอย่าง',
    budget: 50000,
    materialCost: 2500,
    materialReturnCost: 500,
    materialNetCost: 2000,
    materialCostRatio: 4.00,
    costPerArea: 200,
    materials: [
      { name: 'วัสดุตัวอย่าง 1', quantityWithdrawn: 5, unit: 'ชิ้น', quantityReturned: 1, quantityUsed: 4, unitPrice: 100, totalCost: 400 },
      { name: 'วัสดุตัวอย่าง 2', quantityWithdrawn: 10, unit: 'ชิ้น', quantityReturned: 2, quantityUsed: 8, unitPrice: 200, totalCost: 1600 }
    ],
    timeline: [
      { date: '01/01/2568', title: 'เริ่มโครงการ', description: 'เริ่มต้นโครงการ' },
      { date: '15/01/2568', title: 'ตรวจสอบความคืบหน้า', description: 'ความคืบหน้า 50%' }
    ]
  };
}

// อัพเดทฟังก์ชัน exportProjectData เพื่อใช้ generateProjectPDF
function exportProjectData(projectId) {
  console.log('ส่งออกข้อมูลโครงการ: ' + projectId);
  
  // สร้าง PDF
  generateProjectPDF(projectId);
}

// อัพเดทฟังก์ชัน printProjectReport เพื่อสั่งพิมพ์ PDF โดยตรง
function printProjectReport(projectId) {
  console.log('พิมพ์รายงานโครงการ: ' + projectId);
  
  // สร้าง PDF
  const doc = generateProjectPDF(projectId);
  
  // เปิด PDF ในแท็บใหม่และสั่งพิมพ์
  const pdfDataUri = doc.output('datauristring');
  const printWindow = window.open(pdfDataUri);
  
  // รอให้ PDF โหลดเสร็จแล้วสั่งพิมพ์
  printWindow.addEventListener('load', function() {
    setTimeout(function() {
      printWindow.print();
    }, 500);
  });
}


  </script>
</body>
</html>