<!DOCTYPE html>
<html lang="th" class="light-style layout-navbar-fixed layout-menu-fixed">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title>ประวัติการเบิก-คืนวัสดุ | ระบบจัดสวนครบวงจร</title>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Core CSS -->
  <link rel="stylesheet" href="../assets/vendor/css/rtl/core.css" class="template-customizer-core-css">
  <link rel="stylesheet" href="../assets/vendor/css/rtl/theme-default.css" class="template-customizer-theme-css">
  <link rel="stylesheet" href="../assets/css/demo.css">

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css">
  <link rel="stylesheet" href="../assets/vendor/libs/typeahead-js/typeahead.css">
  <link rel="stylesheet" href="../assets/vendor/libs/flatpickr/flatpickr.css">
  <link rel="stylesheet" href="../assets/vendor/libs/select2/select2.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.41.0/apexcharts.min.css">
  
  <!-- Page CSS -->
  <style>
    :root {
      --primary: #28a745;
      --primary-light: #e9fff0;
      --warning: #ffa726;
      --warning-light: #ffedcc;
      --danger: #ec407a;
      --danger-light: #ffe8e8;
      --info: #42a5f5;
      --info-light: #e3f2fd;
      --text-primary: #566a7f;
      --text-secondary: #99a0ac;
      --bg-light: #f5f6fa;
      
      /* เพิ่มสีสำหรับฟังก์ชันคืนวัสดุ */
      --return-primary: #0d6efd;
      --return-primary-light: #e6f0ff;
      --return-secondary: #6c757d;
      --return-success: #198754;
    }
    
    /* แก้ไขการแสดงผลเมนู */
    .menu-sub {
      display: none; /* ค่าเริ่มต้นซ่อนเมนูย่อย */
    }
    
    .menu-item.active.open > .menu-sub,
    .menu-sub.show {
      display: block !important; /* แสดงเมนูย่อยเมื่อ active หรือมี class show */
    }
    
    .section-heading {
      position: relative;
      padding-left: 1rem;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    
    .section-heading::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background-color: var(--primary);
      border-radius: 4px;
    }
    
    .required-label:after {
      content: " *";
      color: var(--danger);
    }
    
    .form-control, .form-select {
      border-radius: 0.375rem;
      padding: 0.45rem 0.9rem;
      border: 1px solid #dce1e8;
      font-size: 0.9375rem;
      transition: all 0.2s ease;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
    }
    
    /* สไตล์สำหรับหน้ารายการ */
    .card {
      transition: all 0.3s ease;
      border-radius: 0.75rem;
      border: none;
      box-shadow: 0 0.25rem 1rem rgba(161, 172, 184, 0.12);
      margin-bottom: 1.5rem;
    }
    
    .filter-card {
      margin-bottom: 1rem;
      border-radius: 0.75rem;
      padding: 1rem;
    }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    .table th {
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
      background-color: #f9f9fa;
      vertical-align: middle;
    }
    
    .table td {
      vertical-align: middle;
    }
    
    .status-badge {
      padding: 0.35em 0.65em;
      font-size: 0.75em;
      font-weight: 500;
      line-height: 1;
      color: #fff;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25rem;
    }
    
    .status-pending {
      background-color: var(--warning);
    }
    
    .status-completed {
      background-color: var(--primary);
    }
    
    .status-cancelled {
      background-color: var(--danger);
    }
    
    .status-partial {
      background-color: var(--info);
    }
    
    .status-not-returned {
      background-color: var(--return-secondary);
    }
    
    .transaction-type-badge {
      padding: 0.35em 0.65em;
      font-size: 0.75em;
      font-weight: 500;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25rem;
    }
    
    .transaction-withdraw {
      background-color: var(--warning-light);
      color: var(--warning);
    }
    
    .transaction-return {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .search-box {
      position: relative;
    }
    
    .search-box .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }
    
    .search-box .form-control {
      padding-left: 2.5rem;
    }
    
    .condition-badge {
      padding: 0.35em 0.65em;
      font-size: 0.75em;
      font-weight: 500;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25rem;
    }
    
    .condition-good {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .condition-damaged {
      background-color: var(--warning-light);
      color: var(--warning);
    }
    
    .condition-broken {
      background-color: var(--danger-light);
      color: var(--danger);
    }
    
    .summary-card {
      border-radius: 0.75rem;
      border: none;
      box-shadow: 0 0.25rem 1rem rgba(161, 172, 184, 0.12);
      transition: all 0.3s ease;
    }
    
    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0.5rem 1.5rem rgba(161, 172, 184, 0.2);
    }
    
    .summary-icon {
      width: 48px;
      height: 48px;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }
    
    .bg-label-primary {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .bg-label-warning {
      background-color: var(--warning-light);
      color: var(--warning);
    }
    
    .bg-label-danger {
      background-color: var(--danger-light);
      color: var(--danger);
    }
    
    .bg-label-info {
      background-color: var(--info-light);
      color: var(--info);
    }
    
    .pagination-info {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    /* สไตล์สำหรับการแสดงความเชื่อมโยงรายการ */
    .transaction-relationship {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    
    .transaction-relationship-line {
      flex-grow: 1;
      height: 1px;
      background-color: var(--primary);
      margin: 0 0.5rem;
    }
    
    .transaction-accordion-header {
      background-color: var(--bg-light);
      border-radius: 0.5rem;
      padding: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 0.5rem;
    }
    
    .transaction-accordion-header:hover {
      background-color: var(--primary-light);
    }
    
    .transaction-accordion-content {
      padding: 0.5rem;
      border-left: 2px solid var(--primary);
      margin-left: 1rem;
      margin-bottom: 1rem;
    }
    
    .chart-container {
      height: 240px;
      position: relative;
    }
    
    .progress-thin {
      height: 0.3rem;
    }
    
    .progress-label {
      font-size: 0.75rem;
      margin-bottom: 0.25rem;
    }
    
    .transaction-history-item {
      border-left: 3px solid transparent;
      transition: all 0.2s ease;
      margin-bottom: 0.5rem;
    }
    
    .transaction-history-item:hover {
      background-color: var(--bg-light);
    }
    
    .transaction-history-item.withdraw {
      border-left-color: var(--warning);
    }
    
    .transaction-history-item.return {
      border-left-color: var(--primary);
    }
    
    .transaction-history-item.with-return {
      border-bottom: 1px dashed var(--primary);
    }
    
    .return-details {
      background-color: var(--primary-light);
      border-radius: 0.5rem;
      margin-top: 0.5rem;
      padding: 0.5rem;
    }
    
    .transaction-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }
    
    .transaction-icon.withdraw {
      background-color: var(--warning-light);
      color: var(--warning);
    }
    
    .transaction-icon.return {
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    .transaction-item-toggle {
      cursor: pointer;
      user-select: none;
    }
    
    .material-status-progress {
      height: 6px;
      border-radius: 3px;
      overflow: hidden;
    }
    
    .material-status-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }
    
    .tag-badge {
      display: inline-block;
      padding: 0.25em 0.5em;
      font-size: 0.75em;
      font-weight: 500;
      line-height: 1;
      color: #fff;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25rem;
      margin-right: 0.25rem;
      margin-bottom: 0.25rem;
    }
    
    .tag-primary {
      background-color: var(--primary);
    }
    
    .tag-info {
      background-color: var(--info);
    }
    
    .tag-warning {
      background-color: var(--warning);
    }
    
    .tag-danger {
      background-color: var(--danger);
    }
  </style>
</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      
      <!-- Menu -->
      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo">
          <a href="dashboard.html" class="app-brand-link">
            <span class="app-brand-logo demo">
              <svg width="26px" height="26px" viewBox="0 0 26 26" version="1.1">
                <polygon points="7.5 2 7.5 5 4.5 5 4.5 22 17 22 17 19 22 19 22 5 17 5 17 2" fill="#28a745" />
                <polygon points="13 15 10 12 13 9 16 12" fill="#28a745" opacity="0.7" />
              </svg>
            </span>
            <span class="app-brand-text demo menu-text fw-bold ms-2">Green Gardens</span>
          </a>

          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto sidebar-toggle">
            <i class="bx menu-toggle-icon d-none d-xl-block fs-4"></i>
            <i class="bx bx-x d-block d-xl-none bx-sm"></i>
          </a>
        </div>

        <div class="menu-divider mt-0"></div>

        <div class="menu-inner-shadow"></div>

        <ul class="menu-inner py-1">
          <!-- Dashboard -->
          <li class="menu-item">
            <a href="dashboard.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-home-circle"></i>
              <div data-i18n="หน้าหลัก">หน้าหลัก</div>
            </a>
          </li>

          <!-- โครงการลูกค้า -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">จัดการโครงการลูกค้า</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-layout"></i>
              <div data-i18n="โครงการ">โครงการ</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="project-list.html" class="menu-link">
                  <div data-i18n="รายการโครงการ">รายการโครงการ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="project-add.html" class="menu-link">
                  <div data-i18n="เพิ่มโครงการใหม่">เพิ่มโครงการใหม่</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="project-progress.html" class="menu-link">
                  <div data-i18n="ติดตามความคืบหน้า">ติดตามความคืบหน้า</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- วัสดุ -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">จัดการวัสดุและเครื่องมือ</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-package"></i>
              <div data-i18n="วัสดุทั่วไป">วัสดุทั่วไป</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="material-list.html" class="menu-link">
                  <div data-i18n="รายการวัสดุ">รายการวัสดุ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="material-add.html" class="menu-link">
                  <div data-i18n="เพิ่มวัสดุใหม่">เพิ่มวัสดุใหม่</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="stock-receipt.html" class="menu-link">
                  <div data-i18n="รับเข้าสต็อก">รับเข้าสต็อก</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-cube-alt"></i>
              <div data-i18n="วัสดุเครื่องมือช่าง">วัสดุเครื่องมือช่าง</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="construction-list.html" class="menu-link">
                  <div data-i18n="รายการวัสดุ">รายการวัสดุ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="construction-add.html" class="menu-link">
                  <div data-i18n="เพิ่มวัสดุใหม่">เพิ่มวัสดุใหม่</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-wrench"></i>
              <div data-i18n="เครื่องมือช่าง">เครื่องมือช่าง</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="tools-list.html" class="menu-link">
                  <div data-i18n="รายการเครื่องมือ">รายการเครื่องมือ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="tools-add.html" class="menu-link">
                  <div data-i18n="เพิ่มเครื่องมือใหม่">เพิ่มเครื่องมือใหม่</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item active">
            <a href="inventory-withdraw.html" class="menu-link">
              <i class="menu-icon tf-icons bx bx-transfer"></i>
              <div data-i18n="เบิก-คืนวัสดุ">เบิก-คืนวัสดุ</div>
            </a>
          </li>

          <!-- รถ -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">จัดการยานพาหนะ</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-car"></i>
              <div data-i18n="ยานพาหนะ">ยานพาหนะ</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="vehicle-list.html" class="menu-link">
                  <div data-i18n="รายการรถ">รายการรถ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="vehicle-add.html" class="menu-link">
                  <div data-i18n="เพิ่มรถใหม่">เพิ่มรถใหม่</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="vehicle-repair.html" class="menu-link">
                  <div data-i18n="บันทึกการซ่อม">บันทึกการซ่อม</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- รายงาน -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">รายงาน</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-line-chart"></i>
              <div data-i18n="รายงานต่างๆ">รายงานต่างๆ</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="report-projects.html" class="menu-link">
                  <div data-i18n="รายงานโครงการ">รายงานโครงการ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="report-vehicle-cost.html" class="menu-link">
                  <div data-i18n="รายงานค่าใช้จ่ายรถ">รายงานค่าใช้จ่ายรถ</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="report-executive.html" class="menu-link">
                  <div data-i18n="รายงานสำหรับผู้บริหาร">รายงานสำหรับผู้บริหาร</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="report-stock-value.html" class="menu-link">
                  <div data-i18n="รายงานมูลค่าคงคลัง">รายงานมูลค่าคงคลัง</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- ผู้ใช้งาน -->
          <li class="menu-header small text-uppercase">
            <span class="menu-header-text">ระบบจัดการ</span>
          </li>

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons bx bx-user"></i>
              <div data-i18n="ผู้ใช้งาน">ผู้ใช้งาน</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="user-list.html" class="menu-link">
                  <div data-i18n="รายชื่อผู้ใช้">รายชื่อผู้ใช้</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="user-add.html" class="menu-link">
                  <div data-i18n="เพิ่มผู้ใช้ใหม่">เพิ่มผู้ใช้ใหม่</div>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </aside>
      <!-- / Menu -->

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->
        <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme" id="layout-navbar">
          <!-- Menu toggle button -->
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
              <i class="bx bx-menu bx-sm"></i>
            </a>
          </div>

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <!-- Search -->
            <div class="navbar-nav align-items-center">
              <div class="nav-item navbar-search-wrapper mb-0">
                <a class="nav-item nav-link search-toggler px-0" href="javascript:void(0);">
                  <i class="bx bx-search-alt bx-sm"></i>
                  <span class="d-none d-md-inline-block text-muted">ค้นหา (Ctrl+/)</span>
                </a>
              </div>
            </div>
            <!-- /Search -->

            <ul class="navbar-nav flex-row align-items-center ms-auto">
              <!-- Notification -->
              <li class="nav-item dropdown-notifications navbar-dropdown dropdown me-3 me-xl-2">
                <a class="nav-link dropdown-toggle hide-arrow position-relative" href="javascript:void(0);" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                  <i class="bx bx-bell bx-sm"></i>
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">5</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end py-0 dropdown-menu-notification">
                  <li class="dropdown-menu-header border-bottom">
                    <div class="dropdown-header d-flex align-items-center py-3">
                      <h5 class="text-body mb-0 me-auto">การแจ้งเตือน</h5>
                      <a href="javascript:void(0)" class="dropdown-notifications-all text-body" data-bs-toggle="tooltip" data-bs-placement="top" title="Mark all as read"><i class="bx fs-4 bx-envelope-open"></i></a>
                    </div>
                  </li>
                  <li class="dropdown-notifications-list scrollable-container">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item list-group-item-action dropdown-notifications-item">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar bg-light-danger">
                              <span class="avatar-initial rounded-circle bg-label-danger"><i class="bx bx-package"></i></span>
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-1">วัสดุใกล้หมด</h6>
                            <p class="mb-0">ดินปลูกต้นไม้ เหลือน้อยกว่า 10 ถุง</p>
                            <small class="text-muted">1 ชั่วโมงที่แล้ว</small>
                          </div>
                          <div class="flex-shrink-0 dropdown-notifications-actions">
                            <a href="javascript:void(0)" class="dropdown-notifications-read"><span class="badge badge-dot"></span></a>
                            <a href="javascript:void(0)" class="dropdown-notifications-archive"><span class="bx bx-x"></span></a>
                          </div>
                        </div>
                      </li>
                      <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar">
                              <span class="avatar-initial rounded-circle bg-label-warning"><i class="bx bx-error"></i></span>
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-1">วัสดุหมด</h6>
                            <p class="mb-0">หินแกรนิตก้อนเล็ก หมดสต็อก</p>
                            <small class="text-muted">เมื่อวานนี้</small>
                          </div>
                          <div class="flex-shrink-0 dropdown-notifications-actions">
                            <a href="javascript:void(0)" class="dropdown-notifications-read"><span class="badge badge-dot"></span></a>
                            <a href="javascript:void(0)" class="dropdown-notifications-archive"><span class="bx bx-x"></span></a>
                          </div>
                        </div>
                      </li>
                    </ul>
                  </li>
                  <li class="dropdown-menu-footer border-top p-2">
                    <a href="javascript:void(0);" class="btn btn-primary d-flex justify-content-center">
                      ดูการแจ้งเตือนทั้งหมด
                    </a>
                  </li>
                </ul>
              </li>
              <!--/ Notification -->

              <!-- User -->
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../assets/img/avatars/1.png" alt class="rounded-circle">
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="account-settings.html">
                      <div class="d-flex">
                        <div class="flex-shrink-0 me-3">
                          <div class="avatar avatar-online">
                            <img src="../assets/img/avatars/1.png" alt class="rounded-circle">
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <span class="fw-semibold d-block">บุญชัย ผู้จัดการ</span>
                          <small class="text-muted">ผู้บริหาร</small>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="account-settings.html">
                      <i class="bx bx-user me-2"></i>
                      <span class="align-middle">ข้อมูลส่วนตัว</span>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="login.html">
                      <i class="bx bx-power-off me-2"></i>
                      <span class="align-middle">ออกจากระบบ</span>
                    </a>
                  </li>
                </ul>
              </li>
              <!--/ User -->
            </ul>
          </div>
        </nav>
        <!-- / Navbar -->

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->
          <div class="container-xxl flex-grow-1 container-p-y">
            <h4 class="fw-bold py-3 mb-4">ประวัติการเบิก-คืนวัสดุ</h4>

            <!-- สรุปข้อมูลการเบิก-คืน -->
            <div class="row">
              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card h-100">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-primary rounded">
                          <i class="bx bx-transfer-alt"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu1" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu1">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">452 รายการ</h4>
                      <p class="mb-0">รายการเบิก-คืนทั้งหมด</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card h-100">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-warning rounded">
                          <i class="bx bx-log-out-circle"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu2" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu2">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">312 รายการ</h4>
                      <p class="mb-0">รายการเบิกวัสดุ</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card h-100">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-success rounded">
                          <i class="bx bx-log-in-circle"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu3" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu3">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">140 รายการ</h4>
                      <p class="mb-0">รายการคืนวัสดุ</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card h-100">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="avatar">
                        <div class="avatar-initial bg-label-danger rounded">
                          <i class="bx bx-time-five"></i>
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="summaryMenu4" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="summaryMenu4">
                          <a class="dropdown-item" href="javascript:void(0);">ดูรายละเอียด</a>
                          <a class="dropdown-item" href="javascript:void(0);">ส่งออกข้อมูล</a>
                        </div>
                      </div>
                    </div>
                    <div class="mt-4">
                      <h4 class="mb-1">72 รายการ</h4>
                      <p class="mb-0">รายการค้างคืน</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- สถิติการเบิก-คืน -->
            <div class="row">
              <div class="col-md-8 mb-4">
                <div class="card">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">สถิติการเบิก-คืนวัสดุประจำเดือน</h5>
                    <div class="dropdown">
                      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="chartPeriodDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        เดือนนี้
                      </button>
                      <ul class="dropdown-menu" aria-labelledby="chartPeriodDropdown">
                        <li><a class="dropdown-item" href="javascript:void(0);">เดือนนี้</a></li>
                        <li><a class="dropdown-item" href="javascript:void(0);">3 เดือนล่าสุด</a></li>
                        <li><a class="dropdown-item" href="javascript:void(0);">6 เดือนล่าสุด</a></li>
                        <li><a class="dropdown-item" href="javascript:void(0);">ปีนี้</a></li>
                      </ul>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart-container" id="transactionChart">
                      <!-- กราฟจะถูกสร้างด้วย ApexCharts หรือใช้รูปภาพตัวอย่างประกอบในที่นี้ -->
                      <div class="d-flex justify-content-center align-items-center h-100">
                        <img src="../assets/img/charts/transaction-chart-sample.png" alt="สถิติการเบิก-คืนวัสดุ" class="img-fluid" style="max-height: 240px;">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-4 mb-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="card-title mb-0">อัตราการคืนวัสดุ</h5>
                  </div>
                  <div class="card-body">
                    <div class="text-center mb-4">
                      <h2 class="mb-1">68.5%</h2>
                      <p class="text-muted mb-0">อัตราการคืนวัสดุทั้งหมด</p>
                    </div>
                    
                    <div class="mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-1">
                        <div>
                          <span class="fw-semibold">วัสดุทั่วไป</span>
                        </div>
                        <div>
                          <span class="text-muted">คืนแล้ว 59.8%</span>
                        </div>
                      </div>
                      <div class="progress progress-thin">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 59.8%" aria-valuenow="59.8" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-1">
                        <div>
                          <span class="fw-semibold">วัสดุเครื่องมือช่าง</span>
                        </div>
                        <div>
                          <span class="text-muted">คืนแล้ว 47.2%</span>
                        </div>
                      </div>
                      <div class="progress progress-thin">
                        <div class="progress-bar bg-info" role="progressbar" style="width: 47.2%" aria-valuenow="47.2" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-1">
                        <div>
                          <span class="fw-semibold">เครื่องมือช่าง</span>
                        </div>
                        <div>
                          <span class="text-muted">คืนแล้ว 94.1%</span>
                        </div>
                      </div>
                      <div class="progress progress-thin">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 94.1%" aria-valuenow="94.1" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                    </div>
                    
                    <div class="mt-4">
                      <h6>สภาพวัสดุที่คืน</h6>
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="d-flex align-items-center">
                          <span class="badge condition-good me-1">•</span>
                          <span>สภาพดี</span>
                        </div>
                        <span class="fw-semibold">78.3%</span>
                      </div>
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="d-flex align-items-center">
                          <span class="badge condition-damaged me-1">•</span>
                          <span>ชำรุดเล็กน้อย</span>
                        </div>
                        <span class="fw-semibold">14.5%</span>
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                          <span class="badge condition-broken me-1">•</span>
                          <span>เสียหาย/ใช้หมด</span>
                        </div>
                        <span class="fw-semibold">7.2%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ค้นหาและตัวกรอง -->
            <div class="card filter-card mb-4">
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-3">
                    <label for="historyDateFrom" class="form-label">ตั้งแต่วันที่</label>
                    <input type="text" class="form-control flatpickr-date" id="historyDateFrom" placeholder="เลือกวันที่เริ่มต้น">
                  </div>
                  <div class="col-md-3">
                    <label for="historyDateTo" class="form-label">ถึงวันที่</label>
                    <input type="text" class="form-control flatpickr-date" id="historyDateTo" placeholder="เลือกวันที่สิ้นสุด">
                  </div>
                  <div class="col-md-3">
                    <label for="historyTransactionType" class="form-label">ประเภทรายการ</label>
                    <select class="form-select" id="historyTransactionType">
                      <option value="">ทั้งหมด</option>
                      <option value="withdraw">เบิก</option>
                      <option value="return">คืน</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="historyReturnStatus" class="form-label">สถานะการคืน</label>
                    <select class="form-select" id="historyReturnStatus">
                      <option value="">ทั้งหมด</option>
                      <option value="fully-returned">คืนครบแล้ว</option>
                      <option value="partially-returned">คืนบางส่วน</option>
                      <option value="not-returned">ยังไม่คืน</option>
                      <option value="overdue">เกินกำหนดคืน</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="historyProject" class="form-label">โครงการ</label>
                    <select class="form-select" id="historyProject">
                      <option value="">ทั้งหมด</option>
                      <option value="P001">สวนบ้านคุณสมชาย (P001)</option>
                      <option value="P002">สวนหมู่บ้านวิลล่า (P002)</option>
                      <option value="P003">ภูมิทัศน์โรงเรียนสตรี (P003)</option>
                      <option value="OFFICE">สำนักงานใหญ่</option>
                      <option value="MAINTENANCE">งานซ่อมบำรุง</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="historyUser" class="form-label">ผู้เบิก/คืน</label>
                    <select class="form-select" id="historyUser">
                      <option value="">ทั้งหมด</option>
                      <option value="EMP001">สมศักดิ์ ช่างจัดสวน</option>
                      <option value="EMP002">วิชัย ช่างประปา</option>
                      <option value="EMP003">มานะ พนักงานขับรถ</option>
                      <option value="EMP004">สมหญิง พนักงานคลัง</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label for="historyMaterialCondition" class="form-label">สภาพวัสดุเมื่อคืน</label>
                    <select class="form-select" id="historyMaterialCondition">
                      <option value="">ทั้งหมด</option>
                      <option value="good">สภาพดี</option>
                      <option value="damaged">ชำรุดเล็กน้อย</option>
                      <option value="broken">เสียหาย/ใช้หมด</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <div class="search-box">
                      <i class="bx bx-search search-icon"></i>
                      <input type="text" class="form-control" id="historySearch" placeholder="ค้นหาตามชื่อวัสดุ, รหัส, เลขที่รายการ...">
                    </div>
                  </div>
                  <div class="col-12 mt-3 d-flex justify-content-end">
                    <button type="button" class="btn btn-outline-secondary me-2" id="historyResetBtn">
                      <i class="bx bx-reset me-1"></i> รีเซ็ต
                    </button>
                    <button type="button" class="btn btn-primary" id="historySearchBtn">
                      <i class="bx bx-search me-1"></i> ค้นหา
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ตารางประวัติการเบิก-คืน -->
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">ประวัติการเบิก-คืนวัสดุ</h5>
                <div>
                  <button type="button" class="btn btn-outline-info me-2" id="tracePendingBtn">
                    <i class="bx bx-bell me-1"></i> ติดตามรายการค้างคืน
                  </button>
                  <button type="button" class="btn btn-outline-primary me-2" id="exportBtn">
                    <i class="bx bx-export me-1"></i> ส่งออกข้อมูล
                  </button>
                  <div class="btn-group">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="bx bx-printer me-1"></i> พิมพ์รายงาน
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="javascript:void(0);">รายงานการเบิก-คืนวัสดุ</a></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">รายงานวัสดุค้างคืน</a></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">รายงานสรุปสภาพวัสดุ</a></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">รายงานการเบิก-คืนตามโครงการ</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <!-- รายการแบบแสดงความสัมพันธ์ -->
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th style="width: 40px;">#</th>
                        <th style="width: 90px;">เลขที่รายการ</th>
                        <th style="width: 90px;">วันที่</th>
                        <th style="width: 90px;">ประเภท</th>
                        <th style="width: 180px;">โครงการ</th>
                        <th style="width: 150px;">ผู้เบิก/คืน</th>
                        <th style="width: 90px;">รายการ</th>
                        <th style="width: 110px;">มูลค่า</th>
                        <th style="width: 100px;">สถานะการคืน</th>
                        <th style="width: 100px;">จัดการ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- รายการเบิกที่มีการคืนบางส่วน -->
                      <tr class="transaction-history-item withdraw with-return">
                        <td>1</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary transaction-item-toggle" data-id="TRX001">TRX-001</a>
                        </td>
                        <td>30/03/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-withdraw">เบิก</span>
                        </td>
                        <td>สวนบ้านคุณสมชาย (P001)</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                        <td>3 รายการ</td>
                        <td>฿1,450.00</td>
                        <td>
                          <span class="status-badge status-partial" data-bs-toggle="tooltip" data-bs-placement="top" title="คืนแล้ว 2 จาก 3 รายการ">คืนบางส่วน</span>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="TRX001" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info me-1 track-return" data-id="TRX001" data-bs-toggle="tooltip" data-bs-placement="top" title="ติดตามการคืน">
                              <i class="bx bx-bell"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary print-transaction" data-id="TRX001" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์">
                              <i class="bx bx-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายละเอียดการคืนบางส่วนของ TRX-001 -->
                      <tr class="transaction-history-item return" id="return-details-TRX001" style="display: none; background-color: rgba(40, 167, 69, 0.05);">
                        <td colspan="10">
                          <div class="p-2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                              <h6 class="mb-0">รายละเอียดการคืนวัสดุ</h6>
                              <div>
                                <span class="badge bg-primary">อ้างอิงเลขที่เบิก: TRX-001</span>
                              </div>
                            </div>
                            
                            <div class="table-responsive">
                              <table class="table table-sm table-bordered mb-0">
                                <thead class="table-light">
                                  <tr>
                                    <th>รายการวัสดุ</th>
                                    <th>จำนวนเบิก</th>
                                    <th>จำนวนคืน</th>
                                    <th>เลขที่คืน</th>
                                    <th>วันที่คืน</th>
                                    <th>สภาพวัสดุ</th>
                                    <th>ผู้รับคืน</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td>ดินปลูกต้นไม้</td>
                                    <td>5 ถุง</td>
                                    <td>5 ถุง</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-001</a></td>
                                    <td>02/04/2568</td>
                                    <td><span class="condition-badge condition-good">สภาพดี</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr>
                                    <td>หินแกรนิตเล็ก</td>
                                    <td>10 ถุง</td>
                                    <td>8 ถุง</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-001</a></td>
                                    <td>02/04/2568</td>
                                    <td><span class="condition-badge condition-broken">เสียหาย/ใช้หมด</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr class="table-warning">
                                    <td>สว่านไฟฟ้า</td>
                                    <td>1 เครื่อง</td>
                                    <td>0 เครื่อง</td>
                                    <td><span class="text-muted">-</span></td>
                                    <td><span class="text-muted">-</span></td>
                                    <td><span class="text-muted">-</span></td>
                                    <td><span class="text-muted">-</span></td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            
                            <div class="mt-2 d-flex justify-content-end">
                              <button type="button" class="btn btn-sm btn-primary" onclick="recordReturn('TRX001')">
                                <i class="bx bx-log-in-circle me-1"></i> บันทึกการคืนเพิ่มเติม
                              </button>
                            </div>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายการเบิกที่คืนครบแล้ว -->
                      <tr class="transaction-history-item withdraw with-return">
                        <td>2</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary transaction-item-toggle" data-id="TRX002">TRX-002</a>
                        </td>
                        <td>29/03/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-withdraw">เบิก</span>
                        </td>
                        <td>สวนหมู่บ้านวิลล่า (P002)</td>
                        <td>วิชัย ช่างประปา</td>
                        <td>5 รายการ</td>
                        <td>฿2,875.00</td>
                        <td>
                          <span class="status-badge status-completed">คืนครบแล้ว</span>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="TRX002" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary print-transaction" data-id="TRX002" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์">
                              <i class="bx bx-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายละเอียดการคืนของ TRX-002 -->
                      <tr class="transaction-history-item return" id="return-details-TRX002" style="display: none; background-color: rgba(40, 167, 69, 0.05);">
                        <td colspan="10">
                          <div class="p-2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                              <h6 class="mb-0">รายละเอียดการคืนวัสดุ</h6>
                              <div>
                                <span class="badge bg-primary">อ้างอิงเลขที่เบิก: TRX-002</span>
                                <span class="badge bg-success">คืนครบทุกรายการแล้ว</span>
                              </div>
                            </div>
                            
                            <div class="table-responsive">
                              <table class="table table-sm table-bordered mb-0">
                                <thead class="table-light">
                                  <tr>
                                    <th>รายการวัสดุ</th>
                                    <th>จำนวนเบิก</th>
                                    <th>จำนวนคืน</th>
                                    <th>เลขที่คืน</th>
                                    <th>วันที่คืน</th>
                                    <th>สภาพวัสดุ</th>
                                    <th>ผู้รับคืน</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td>ท่อ PVC 1 นิ้ว</td>
                                    <td>20 เส้น</td>
                                    <td>15 เส้น</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-002</a></td>
                                    <td>03/04/2568</td>
                                    <td><span class="condition-badge condition-good">สภาพดี</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr>
                                    <td>ท่อ PVC 1 นิ้ว</td>
                                    <td>20 เส้น</td>
                                    <td>5 เส้น</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-003</a></td>
                                    <td>05/04/2568</td>
                                    <td><span class="condition-badge condition-damaged">ชำรุดเล็กน้อย</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr>
                                    <td>ปูนซีเมนต์ถุงเล็ก</td>
                                    <td>5 ถุง</td>
                                    <td>0 ถุง</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-003</a></td>
                                    <td>05/04/2568</td>
                                    <td><span class="condition-badge condition-broken">เสียหาย/ใช้หมด</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr>
                                    <td>ข้อต่อ PVC 1 นิ้ว</td>
                                    <td>10 อัน</td>
                                    <td>8 อัน</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-002</a></td>
                                    <td>03/04/2568</td>
                                    <td><span class="condition-badge condition-good">สภาพดี</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr>
                                    <td>ข้อต่อ PVC 1 นิ้ว</td>
                                    <td>10 อัน</td>
                                    <td>2 อัน</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-003</a></td>
                                    <td>05/04/2568</td>
                                    <td><span class="condition-badge condition-broken">เสียหาย/ใช้หมด</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                  <tr>
                                    <td>เทปพันเกลียว</td>
                                    <td>2 ม้วน</td>
                                    <td>0 ม้วน</td>
                                    <td><a href="javascript:void(0);" class="text-primary">RTN-003</a></td>
                                    <td>05/04/2568</td>
                                    <td><span class="condition-badge condition-broken">เสียหาย/ใช้หมด</span></td>
                                    <td>สมหญิง พนักงานคลัง</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            
                            <div class="alert alert-info mt-2 mb-0">
                              <i class="bx bx-info-circle me-1"></i>
                              รายการวัสดุที่ไม่ได้คืนหรือคืนในสภาพ "เสียหาย/ใช้หมด" ถือว่าเป็นการใช้งานตามปกติของโครงการ
                            </div>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายการคืน -->
                      <tr class="transaction-history-item return">
                        <td>3</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary view-detail" data-id="RTN001">RTN-001</a>
                        </td>
                        <td>02/04/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-return">คืน</span>
                        </td>
                        <td>สวนบ้านคุณสมชาย (P001)</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                        <td>2 รายการ</td>
                        <td>-</td>
                        <td>
                          <span class="status-badge status-completed">เสร็จสิ้น</span>
                          <div style="font-size: 0.75rem; color: var(--primary);">อ้างอิง: TRX-001</div>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="RTN001" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary print-transaction" data-id="RTN001" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์">
                              <i class="bx bx-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายการเบิกที่ยังไม่คืน -->
                      <tr class="transaction-history-item withdraw">
                        <td>4</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary view-detail" data-id="TRX004">TRX-004</a>
                        </td>
                        <td>27/03/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-withdraw">เบิก</span>
                        </td>
                        <td>งานซ่อมบำรุง</td>
                        <td>มานะ พนักงานขับรถ</td>
                        <td>2 รายการ</td>
                        <td>฿350.00</td>
                        <td>
                          <span class="status-badge status-not-returned" data-bs-toggle="tooltip" data-bs-placement="top" title="ค้างคืน 13 วัน">ยังไม่คืน</span>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="TRX004" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-info me-1 track-return" data-id="TRX004" data-bs-toggle="tooltip" data-bs-placement="top" title="ติดตามการคืน">
                              <i class="bx bx-bell"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-warning record-return" data-id="TRX004" data-bs-toggle="tooltip" data-bs-placement="top" title="บันทึกการคืน">
                              <i class="bx bx-log-in-circle"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายการคืน 2 -->
                      <tr class="transaction-history-item return">
                        <td>5</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary view-detail" data-id="RTN002">RTN-002</a>
                        </td>
                        <td>03/04/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-return">คืน</span>
                        </td>
                        <td>สวนหมู่บ้านวิลล่า (P002)</td>
                        <td>วิชัย ช่างประปา</td>
                        <td>2 รายการ</td>
                        <td>-</td>
                        <td>
                          <span class="status-badge status-completed">เสร็จสิ้น</span>
                          <div style="font-size: 0.75rem; color: var(--primary);">อ้างอิง: TRX-002</div>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="RTN002" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary print-transaction" data-id="RTN002" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์">
                              <i class="bx bx-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายการคืน 3 -->
                      <tr class="transaction-history-item return">
                        <td>6</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary view-detail" data-id="RTN003">RTN-003</a>
                        </td>
                        <td>05/04/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-return">คืน</span>
                        </td>
                        <td>สวนหมู่บ้านวิลล่า (P002)</td>
                        <td>วิชัย ช่างประปา</td>
                        <td>3 รายการ</td>
                        <td>-</td>
                        <td>
                          <span class="status-badge status-completed">เสร็จสิ้น</span>
                          <div style="font-size: 0.75rem; color: var(--primary);">อ้างอิง: TRX-002</div>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="RTN003" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary print-transaction" data-id="RTN003" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์">
                              <i class="bx bx-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                      
                      <!-- รายการเบิกที่ถูกยกเลิก -->
                      <tr class="transaction-history-item withdraw">
                        <td>7</td>
                        <td>
                          <a href="javascript:void(0);" class="fw-semibold text-primary view-detail" data-id="TRX005">TRX-005</a>
                        </td>
                        <td>26/03/2568</td>
                        <td>
                          <span class="transaction-type-badge transaction-withdraw">เบิก</span>
                        </td>
                        <td>ภูมิทัศน์โรงเรียนสตรี (P003)</td>
                        <td>สมศักดิ์ ช่างจัดสวน</td>
                        <td>4 รายการ</td>
                        <td>฿2,240.00</td>
                        <td>
                          <span class="status-badge status-cancelled">ยกเลิก</span>
                        </td>
                        <td>
                          <div class="d-flex">
                            <button type="button" class="btn btn-sm btn-icon btn-outline-primary me-1 view-detail" data-id="TRX005" data-bs-toggle="tooltip" data-bs-placement="top" title="ดูรายละเอียด">
                              <i class="bx bx-detail"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-icon btn-outline-secondary print-transaction" data-id="TRX005" data-bs-toggle="tooltip" data-bs-placement="top" title="พิมพ์">
                              <i class="bx bx-printer"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div class="pagination-info">
                    แสดง 1 ถึง 7 จาก 452 รายการ
                  </div>
                  <nav aria-label="Page navigation">
                    <ul class="pagination">
                      <li class="page-item prev">
                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-left"></i></a>
                      </li>
                      <li class="page-item active">
                        <a class="page-link" href="javascript:void(0);">1</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">2</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">3</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">4</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="javascript:void(0);">5</a>
                      </li>
                      <li class="page-item next">
                        <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-right"></i></a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </div>
          <!-- / Content -->

          <!-- Footer -->
          <footer class="content-footer footer bg-footer-theme">
            <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
              <div class="mb-2 mb-md-0">
                © <script>
                  document.write(new Date().getFullYear())
                </script>
                , ระบบจัดสวนครบวงจร v1.0
              </div>
              <div>
                <a href="#" class="footer-link me-4">หน้าหลัก</a>
                <a href="#" class="footer-link me-4">เกี่ยวกับเรา</a>
                <a href="#" class="footer-link me-4">ช่วยเหลือ</a>
                <a href="#" class="footer-link">ติดต่อเรา</a>
              </div>
            </div>
          </footer>
          <!-- / Footer -->

          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
  </div>
  <!-- / Layout wrapper -->

  <!-- Transaction Detail Modal -->
  <div class="modal fade" id="transactionDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">รายละเอียดการเบิก-คืนวัสดุ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- ข้อมูลจะถูกโหลดด้วย JavaScript เมื่อมีการคลิกดูรายละเอียด -->
          <div id="transactionDetailsContent">
            <div class="row mb-3">
              <div class="col-md-6">
                <h6>ข้อมูลรายการ</h6>
                <table class="table table-sm table-borderless">
                  <tr>
                    <td style="width: 40%;">เลขที่รายการ:</td>
                    <td><strong>TRX-001</strong></td>
                  </tr>
                  <tr>
                    <td>วันที่:</td>
                    <td>30/03/2568</td>
                  </tr>
                  <tr>
                    <td>ประเภท:</td>
                    <td><span class="transaction-type-badge transaction-withdraw">เบิก</span></td>
                  </tr>
                  <tr>
                    <td>สถานะการคืน:</td>
                    <td><span class="status-badge status-partial">คืนบางส่วน</span></td>
                  </tr>
                </table>
              </div>
              <div class="col-md-6">
                <h6>ข้อมูลผู้เบิก/คืน</h6>
                <table class="table table-sm table-borderless">
                  <tr>
                    <td style="width: 40%;">ผู้เบิก/คืน:</td>
                    <td><strong>สมศักดิ์ ช่างจัดสวน</strong></td>
                  </tr>
                  <tr>
                    <td>โครงการ:</td>
                    <td>สวนบ้านคุณสมชาย (P001)</td>
                  </tr>
                  <tr>
                    <td>ผู้บันทึก:</td>
                    <td>สมหญิง พนักงานคลัง</td>
                  </tr>
                  <tr>
                    <td>หมายเหตุ:</td>
                    <td>วัสดุสำหรับงวดที่ 2 ของโครงการ</td>
                  </tr>
                </table>
              </div>
            </div>
            
            <!-- แท็บสำหรับแยกดูข้อมูลการเบิกและการคืน -->
            <ul class="nav nav-tabs" id="transactionDetailTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="withdraw-items-tab" data-bs-toggle="tab" data-bs-target="#withdraw-items" type="button" role="tab" aria-controls="withdraw-items" aria-selected="true">
                  รายการเบิก
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="return-items-tab" data-bs-toggle="tab" data-bs-target="#return-items" type="button" role="tab" aria-controls="return-items" aria-selected="false">
                  รายการคืน
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="transaction-history-tab" data-bs-toggle="tab" data-bs-target="#transaction-history" type="button" role="tab" aria-controls="transaction-history" aria-selected="false">
                  ประวัติการดำเนินการ
                </button>
              </li>
            </ul>
            
            <div class="tab-content" id="transactionDetailTabContent">
              <!-- รายการเบิก -->
              <div class="tab-pane fade show active" id="withdraw-items" role="tabpanel" aria-labelledby="withdraw-items-tab">
                <div class="table-responsive mt-3">
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th style="width: 40px;">#</th>
                        <th>รายการ</th>
                        <th style="width: 100px;">จำนวนเบิก</th>
                        <th style="width: 100px;">ราคา/หน่วย</th>
                        <th style="width: 120px;">รวม</th>
                        <th style="width: 150px;">สถานะการคืน</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td>ดินปลูกต้นไม้</td>
                        <td>5 ถุง</td>
                        <td>฿120.00</td>
                        <td>฿600.00</td>
                        <td>
                          <div class="d-flex align-items-center">
                            <div class="flex-grow-1">
                              <div class="progress progress-thin" style="height: 6px;">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                              <small class="text-success">คืนแล้ว 5/5 ถุง</small>
                            </div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>หินแกรนิตเล็ก</td>
                        <td>10 ถุง</td>
                        <td>฿85.00</td>
                        <td>฿850.00</td>
                        <td>
                          <div class="d-flex align-items-center">
                            <div class="flex-grow-1">
                              <div class="progress progress-thin" style="height: 6px;">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                              <small class="text-warning">คืนแล้ว 8/10 ถุง</small>
                            </div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>สว่านไฟฟ้า</td>
                        <td>1 เครื่อง</td>
                        <td>-</td>
                        <td>-</td>
                        <td>
                          <div class="d-flex align-items-center">
                            <div class="flex-grow-1">
                              <div class="progress progress-thin" style="height: 6px;">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                              <small class="text-danger">ยังไม่คืน 0/1 เครื่อง</small>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td colspan="4" class="text-end fw-bold">รวมทั้งสิ้น:</td>
                        <td class="fw-bold">฿1,450.00</td>
                        <td></td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
              
              <!-- รายการคืน -->
              <div class="tab-pane fade" id="return-items" role="tabpanel" aria-labelledby="return-items-tab">
                <div class="mt-3">
                  <div class="alert alert-primary d-flex align-items-center" role="alert">
                    <i class="bx bx-info-circle me-2"></i>
                    <div>รายการเบิกนี้มีการคืนวัสดุแล้ว 1 ครั้ง โดยมีเลขที่คืน: <strong>RTN-001</strong> เมื่อวันที่ 02/04/2568</div>
                  </div>
                  
                  <div class="table-responsive">
                    <table class="table table-bordered">
                      <thead>
                        <tr>
                          <th style="width: 40px;">#</th>
                          <th>รายการ</th>
                          <th style="width: 100px;">จำนวนเบิก</th>
                          <th style="width: 100px;">จำนวนคืน</th>
                          <th style="width: 100px;">สภาพวัสดุ</th>
                          <th style="width: 150px;">วันที่คืน</th>
                          <th style="width: 140px;">ผู้รับคืน</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>ดินปลูกต้นไม้</td>
                          <td>5 ถุง</td>
                          <td>5 ถุง</td>
                          <td><span class="condition-badge condition-good">สภาพดี</span></td>
                          <td>02/04/2568</td>
                          <td>สมหญิง พนักงานคลัง</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>หินแกรนิตเล็ก</td>
                          <td>10 ถุง</td>
                          <td>8 ถุง</td>
                          <td><span class="condition-badge condition-broken">เสียหาย/ใช้หมด</span></td>
                          <td>02/04/2568</td>
                          <td>สมหญิง พนักงานคลัง</td>
                        </tr>
                        <tr class="table-warning">
                          <td>3</td>
                          <td>สว่านไฟฟ้า</td>
                          <td>1 เครื่อง</td>
                          <td>0 เครื่อง</td>
                          <td><span class="text-muted">-</span></td>
                          <td><span class="text-muted">-</span></td>
                          <td><span class="text-muted">-</span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  
                  <div class="mt-3">
                    <h6>สรุปสถานะการคืน</h6>
                    <div class="progress" style="height: 20px;">
                      <div class="progress-bar bg-success" role="progressbar" style="width: 66.67%" aria-valuenow="66.67" aria-valuemin="0" aria-valuemax="100">
                        คืนแล้ว 2/3 รายการ
                      </div>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                      <small class="text-muted">2 รายการคืนแล้ว</small>
                      <small class="text-muted">1 รายการยังไม่คืน</small>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- ประวัติการดำเนินการ -->
              <div class="tab-pane fade" id="transaction-history" role="tabpanel" aria-labelledby="transaction-history-tab">
                <div class="mt-3">
                  <table class="table table-sm">
                    <thead>
                      <tr>
                        <th>วันที่-เวลา</th>
                        <th>การดำเนินการ</th>
                        <th>ผู้ดำเนินการ</th>
                        <th>หมายเหตุ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>30/03/2568 09:15</td>
                        <td>สร้างรายการเบิก</td>
                        <td>สมหญิง พนักงานคลัง</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>30/03/2568 09:20</td>
                        <td>อนุมัติการเบิก</td>
                        <td>บุญชัย ผู้จัดการ</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>30/03/2568 09:25</td>
                        <td>จ่ายวัสดุ</td>
                        <td>สมหญิง พนักงานคลัง</td>
                        <td>ส่งมอบให้ผู้เบิกเรียบร้อยแล้ว</td>
                      </tr>
                      <tr>
                        <td>02/04/2568 14:30</td>
                        <td>บันทึกการคืนวัสดุ</td>
                        <td>สมหญิง พนักงานคลัง</td>
                        <td>คืนดินปลูกต้นไม้ 5 ถุง, หินแกรนิตเล็ก 8 ถุง</td>
                      </tr>
                      <tr>
                        <td>09/04/2568 10:05</td>
                        <td>ส่งแจ้งเตือนการคืน</td>
                        <td>ระบบอัตโนมัติ</td>
                        <td>แจ้งเตือนวัสดุค้างคืน: สว่านไฟฟ้า</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-warning me-2" id="trackReturnBtn">
            <i class="bx bx-bell me-1"></i> ติดตามการคืน
          </button>
          <button type="button" class="btn btn-outline-primary me-2" id="recordReturnModalBtn">
            <i class="bx bx-log-in-circle me-1"></i> บันทึกการคืน
          </button>
          <button type="button" class="btn btn-outline-secondary me-2" id="printDetailBtn">
            <i class="bx bx-printer me-1"></i> พิมพ์
          </button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ปิด</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Record Return Modal -->
  <div class="modal fade" id="recordReturnModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">บันทึกการคืนวัสดุ</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-primary d-flex align-items-center mb-3" role="alert">
            <i class="bx bx-info-circle me-2"></i>
            <div>กำลังบันทึกการคืนวัสดุของเลขที่เบิก: <strong id="returnWithdrawId">TRX-001</strong></div>
          </div>
          
          <form id="returnForm">
            <div class="mb-3">
              <label class="form-label required-label">รายการคืนวัสดุ</label>
              <div id="returnFormItems">
                <!-- รายการที่ยังไม่ได้คืนจาก TRX-001 -->
                <div class="return-item card mb-2 border">
                  <div class="card-body p-2">
                    <div class="d-flex justify-content-between mb-1">
                      <span class="fw-semibold">สว่านไฟฟ้า</span>
                      <small class="text-muted">เบิก: 1 เครื่อง</small>
                    </div>
                    <div class="row g-2">
                      <div class="col-6">
                        <div class="input-group input-group-sm">
                          <span class="input-group-text">คืน</span>
                          <input type="number" class="form-control return-qty" min="0" max="1" value="1">
                          <span class="input-group-text">เครื่อง</span>
                        </div>
                      </div>
                      <div class="col-6">
                        <select class="form-select form-select-sm return-condition">
                          <option value="good">สภาพดี</option>
                          <option value="damaged" selected>ชำรุดเล็กน้อย</option>
                          <option value="broken">เสียหาย/ใช้หมด</option>
                        </select>
                      </div>
                    </div>
                    <div class="mt-2">
                      <label class="form-label text-muted" style="font-size: 0.875rem;">หมายเหตุเพิ่มเติม (ถ้ามี)</label>
                      <textarea class="form-control form-control-sm" rows="1" placeholder="ระบุรายละเอียดเพิ่มเติม เช่น สภาพวัสดุ"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row g-3">
              <div class="col-md-6">
                <label for="returnDate" class="form-label required-label">วันที่คืน</label>
                <input type="text" class="form-control flatpickr-date" id="returnDate" placeholder="เลือกวันที่" required>
              </div>
              
              <div class="col-md-6">
                <label for="returnReceiverSelect" class="form-label required-label">ผู้รับคืน</label>
                <select class="form-select" id="returnReceiverSelect" required>
                  <option value="">-- เลือกผู้รับคืน --</option>
                  <option value="EMP004" selected>สมหญิง พนักงานคลัง</option>
                  <option value="EMP005">ธีรพงษ์ เจ้าหน้าที่คลัง</option>
                </select>
              </div>
              
              <div class="col-12">
                <label for="returnNote" class="form-label">หมายเหตุการคืน</label>
                <textarea class="form-control" id="returnNote" rows="2" placeholder="ระบุรายละเอียดเพิ่มเติม เช่น สภาพวัสดุ หรือเหตุผลในการคืน"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ยกเลิก</button>
          <button type="button" class="btn btn-primary" id="submitReturnBtn">
            <i class="bx bx-check-circle me-1"></i> บันทึกการคืน
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Track Return Modal -->
  <div class="modal fade" id="trackReturnModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title">ติดตามการคืนวัสดุ</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info d-flex align-items-center mb-3" role="alert">
            <i class="bx bx-info-circle me-2"></i>
            <div>กำลังติดตามการคืนวัสดุของเลขที่เบิก: <strong id="trackingWithdrawId">TRX-001</strong></div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">วัสดุที่ยังไม่ได้คืน</label>
            <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                สว่านไฟฟ้า
                <span class="badge bg-danger rounded-pill">1 เครื่อง</span>
              </li>
            </ul>
          </div>
          
          <div class="mb-3">
            <label for="trackingMethod" class="form-label required-label">วิธีการติดตาม</label>
            <select class="form-select" id="trackingMethod" required>
              <option value="">-- เลือกวิธีการติดตาม --</option>
              <option value="notification">แจ้งเตือนในระบบ</option>
              <option value="email">ส่งอีเมล</option>
              <option value="sms">ส่ง SMS</option>
              <option value="call">โทรติดตาม</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label for="trackingPriority" class="form-label">ระดับความสำคัญ</label>
            <select class="form-select" id="trackingPriority">
              <option value="normal">ปกติ</option>
              <option value="urgent" selected>เร่งด่วน</option>
              <option value="critical">สำคัญมาก</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label for="trackingNote" class="form-label">หมายเหตุ</label>
            <textarea class="form-control" id="trackingNote" rows="2" placeholder="ระบุรายละเอียดเพิ่มเติม"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ยกเลิก</button>
          <button type="button" class="btn btn-info" id="submitTrackingBtn">
            <i class="bx bx-send me-1"></i> ส่งการติดตาม
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Success Alert Modal -->
  <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header bg-success">
          <h5 class="modal-title text-white">สำเร็จ</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bx bx-check-circle text-success mb-3" style="font-size: 5rem;"></i>
          <h5 id="successTitle">บันทึกข้อมูลสำเร็จ</h5>
          <p class="mb-2" id="successMessage">บันทึกรายการคืนวัสดุเรียบร้อยแล้ว</p>
          <p class="fw-bold" id="successRefId">เลขที่รายการ: RTN-004</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" data-bs-dismiss="modal">
            <i class="bx bx-check me-1"></i> ตกลง
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Core JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>

  <!-- Vendors JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.41.0/apexcharts.min.js"></script>

  <!-- Page JS -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Flatpickr for date inputs
      flatpickr(".flatpickr-date", {
        dateFormat: "d/m/Y",
        defaultDate: new Date()
      });
      
      // Initialize Select2 for dropdowns
      $('.form-select').select2({
        width: '100%'
      });
      
      // Initialize tooltips
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
      
      // แก้ไขการแสดงผลเมนู
      function initializeMenu() {
        // ปรับการแสดงผลเมนูย่อยเมื่อคลิกที่เมนูหลัก
        const menuToggles = document.querySelectorAll('.menu-toggle');
        menuToggles.forEach(toggle => {
          toggle.addEventListener('click', function(e) {
            e.preventDefault();
            const menuItem = this.closest('.menu-item');
            const menuSub = menuItem.querySelector('.menu-sub');
            
            // Toggle active และ open classes
            menuItem.classList.toggle('active');
            menuItem.classList.toggle('open');
            
            // แสดง/ซ่อนเมนูย่อย
            if (menuSub.style.display === 'block') {
              menuSub.style.display = 'none';
            } else {
              menuSub.style.display = 'block';
            }
          });
        });
      }
      
      // เรียกใช้ฟังก์ชันจัดการเมนู
      initializeMenu();
      
      // การแสดงรายละเอียดการคืน (Toggle)
      document.querySelectorAll('.transaction-item-toggle').forEach(item => {
        item.addEventListener('click', function() {
          const transactionId = this.getAttribute('data-id');
          const returnDetailsRow = document.getElementById(`return-details-${transactionId}`);
          
          if (returnDetailsRow) {
            if (returnDetailsRow.style.display === 'none' || returnDetailsRow.style.display === '') {
              returnDetailsRow.style.display = 'table-row';
              // ปิดรายการอื่นที่อาจเปิดอยู่
              document.querySelectorAll('[id^="return-details-"]').forEach(row => {
                if (row.id !== `return-details-${transactionId}`) {
                  row.style.display = 'none';
                }
              });
            } else {
              returnDetailsRow.style.display = 'none';
            }
          }
        });
      });
      
      // ตรวจสอบปุ่มบันทึกการคืน
      document.querySelectorAll('.record-return').forEach(btn => {
        btn.addEventListener('click', function() {
          const transactionId = this.getAttribute('data-id');
          document.getElementById('returnWithdrawId').textContent = transactionId;
          $('#recordReturnModal').modal('show');
        });
      });
      
      // ตรวจสอบปุ่มติดตามการคืน
      document.querySelectorAll('.track-return').forEach(btn => {
        btn.addEventListener('click', function() {
          const transactionId = this.getAttribute('data-id');
          document.getElementById('trackingWithdrawId').textContent = transactionId;
          $('#trackReturnModal').modal('show');
        });
      });
      
      // ตรวจสอบปุ่มดูรายละเอียด
      document.querySelectorAll('.view-detail').forEach(btn => {
        btn.addEventListener('click', function() {
          const transactionId = this.getAttribute('data-id');
          // ในอนาคตอาจจะโหลดข้อมูลจาก API ด้วย transactionId
          $('#transactionDetailModal').modal('show');
        });
      });
      
      // ตรวจสอบปุ่มพิมพ์
      document.querySelectorAll('.print-transaction').forEach(btn => {
        btn.addEventListener('click', function() {
          const transactionId = this.getAttribute('data-id');
          // ในอนาคตอาจสร้างหน้าสำหรับพิมพ์
          alert(`กำลังพิมพ์รายการ ${transactionId}`);
        });
      });
      
      // ปุ่มบันทึกการคืนในโมดัล
      document.getElementById('submitReturnBtn').addEventListener('click', function() {
        // จำลองการบันทึกข้อมูล
        $('#recordReturnModal').modal('hide');
        
        // แสดงข้อความสำเร็จ
        document.getElementById('successTitle').textContent = 'บันทึกการคืนสำเร็จ';
        document.getElementById('successMessage').textContent = 'บันทึกรายการคืนวัสดุเรียบร้อยแล้ว';
        document.getElementById('successRefId').textContent = 'เลขที่รายการ: RTN-004';
        
        $('#successModal').modal('show');
      });
      
      // ปุ่มส่งการติดตามในโมดัล
      document.getElementById('submitTrackingBtn').addEventListener('click', function() {
        // จำลองการส่งการติดตาม
        $('#trackReturnModal').modal('hide');
        
        // แสดงข้อความสำเร็จ
        document.getElementById('successTitle').textContent = 'ส่งการติดตามสำเร็จ';
        document.getElementById('successMessage').textContent = 'ส่งการติดตามการคืนวัสดุเรียบร้อยแล้ว';
        document.getElementById('successRefId').textContent = 'รหัสติดตาม: TRACK-001';
        
        $('#successModal').modal('show');
      });
      
      // ปุ่มรีเซ็ตตัวกรอง
      document.getElementById('historyResetBtn').addEventListener('click', function() {
        document.getElementById('historyDateFrom').value = '';
        document.getElementById('historyDateTo').value = '';
        document.getElementById('historyTransactionType').value = '';
        document.getElementById('historyReturnStatus').value = '';
        document.getElementById('historyProject').value = '';
        document.getElementById('historyUser').value = '';
        document.getElementById('historyMaterialCondition').value = '';
        document.getElementById('historySearch').value = '';
        
        // รีเซ็ต Select2
        $('#historyTransactionType').val('').trigger('change');
        $('#historyReturnStatus').val('').trigger('change');
        $('#historyProject').val('').trigger('change');
        $('#historyUser').val('').trigger('change');
        $('#historyMaterialCondition').val('').trigger('change');
      });
      
      // ปุ่มค้นหาประวัติรายการ
      document.getElementById('historySearchBtn').addEventListener('click', function() {
        // จำลองการค้นหา
        alert('กำลังค้นหารายการตามเงื่อนไขที่กำหนด');
      });
      
      // ปุ่มติดตามรายการค้างคืน
      document.getElementById('tracePendingBtn').addEventListener('click', function() {
        // จำลองการเปิดหน้าติดตามรายการค้างคืน
        alert('กำลังเปิดหน้าติดตามรายการค้างคืน');
      });
      
      // ปุ่มส่งออกข้อมูล
      document.getElementById('exportBtn').addEventListener('click', function() {
        // จำลองการส่งออก
        alert('กำลังส่งออกข้อมูลในรูปแบบ Excel');
      });
      
      // ปุ่มบันทึกการคืน (จากรายละเอียดรายการ)
      document.getElementById('recordReturnModalBtn').addEventListener('click', function() {
        // อาจนำข้อมูลจากรายการที่กำลังดูรายละเอียดมาใส่ในโมดัลบันทึกการคืน
        $('#transactionDetailModal').modal('hide');
        $('#recordReturnModal').modal('show');
      });
      
      // ปุ่มติดตามการคืน (จากรายละเอียดรายการ)
      document.getElementById('trackReturnBtn').addEventListener('click', function() {
        // อาจนำข้อมูลจากรายการที่กำลังดูรายละเอียดมาใส่ในโมดัลติดตามการคืน
        $('#transactionDetailModal').modal('hide');
        $('#trackReturnModal').modal('show');
      });
      
      // ปุ่มพิมพ์รายละเอียด
      document.getElementById('printDetailBtn').addEventListener('click', function() {
        // จำลองการพิมพ์
        alert('กำลังพิมพ์รายละเอียดรายการ');
      });
      
      // ฟังก์ชันบันทึกการคืนจากตารางประวัติ (สำหรับเรียกจาก onclick attribute)
      window.recordReturn = function(transactionId) {
        document.getElementById('returnWithdrawId').textContent = transactionId;
        $('#recordReturnModal').modal('show');
      };
      
      // เปลี่ยนหน้าการแสดงผลตาราง (pagination)
      document.querySelectorAll('.pagination .page-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          document.querySelectorAll('.pagination .page-item').forEach(item => {
            item.classList.remove('active');
          });
          
          if (!this.closest('.page-item').classList.contains('prev') && 
              !this.closest('.page-item').classList.contains('next')) {
            this.closest('.page-item').classList.add('active');
          }
        });
      });
      
      // สร้างกราฟสถิติการเบิก-คืน
      function initializeCharts() {
        if (typeof ApexCharts !== 'undefined' && document.getElementById('transactionChart') !== null) {
          const options = {
            series: [{
              name: 'รายการเบิก',
              type: 'column',
              data: [24, 18, 30, 22, 35, 29, 26, 32, 28, 20, 25, 23]
            }, {
              name: 'รายการคืน',
              type: 'column',
              data: [18, 14, 22, 15, 26, 22, 18, 24, 20, 15, 20, 16]
            }, {
              name: 'อัตราการคืน (%)',
              type: 'line',
              data: [75, 78, 73, 68, 74, 76, 69, 75, 71, 75, 80, 70]
            }],
            chart: {
              height: 240,
              type: 'line',
              stacked: false,
              toolbar: {
                show: false
              }
            },
            stroke: {
              width: [0, 0, 3],
              curve: 'smooth'
            },
            plotOptions: {
              bar: {
                columnWidth: '60%'
              }
            },
            colors: ['#ffa726', '#28a745', '#42a5f5'],
            fill: {
              opacity: [0.85, 0.85, 1],
              gradient: {
                inverseColors: false,
                shade: 'light',
                type: "vertical",
                opacityFrom: 0.85,
                opacityTo: 0.55,
                stops: [0, 100, 100, 100]
              }
            },
            markers: {
              size: 3
            },
            xaxis: {
              categories: ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.']
            },
            yaxis: [{
              title: {
                text: 'จำนวนรายการ',
              },
            }, {
              opposite: true,
              title: {
                text: 'อัตราการคืน (%)'
              },
              min: 0,
              max: 100
            }],
            tooltip: {
              shared: true,
              intersect: false,
              y: {
                formatter: function(y) {
                  if (typeof y !== "undefined") {
                    return y.toFixed(0) + (this.seriesIndex === 2 ? "%" : " รายการ");
                  }
                  return y;
                }
              }
            }
          };

          try {
            const chart = new ApexCharts(document.getElementById('transactionChart'), options);
            chart.render();
          } catch (error) {
            console.error('Error initializing chart:', error);
          }
        }
      }
      
      // ลองเรียกฟังก์ชันสร้างกราฟ
      setTimeout(initializeCharts, 100);
    });
  </script>
</body>
</html>